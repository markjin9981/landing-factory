import{j as e}from"./animation-BOIIKJnC.js";import{r as i,L as q}from"./vendor-B_BVtOF2.js";import{z as J,X as K,J as X,f as _}from"./index-DvRab7Y9.js";import{A as G}from"./arrow-left-DMsESK-x.js";import{R as H}from"./refresh-cw-DqMPdokG.js";import{F as Q}from"./filter-CJAEM7XY.js";import{S as k}from"./smartphone-Dkh8a9yS.js";import{M as $}from"./monitor-ZVGWtj5v.js";const ne=()=>{const[o,R]=i.useState([]),[y,T]=i.useState([]),[b,w]=i.useState(!0),[u,F]=i.useState("all"),[f,O]=i.useState("desc"),[j,P]=i.useState("timestamp"),[d,D]=i.useState(null),[v,S]=i.useState(!1),[c,I]=i.useState(new Date),C=async()=>{w(!0);const[t,s]=await Promise.all([X(),_()]);R(t),T(s),w(!1)};i.useEffect(()=>{C()},[]);const N=t=>{if(!t||typeof t!="string")return 0;const s=new Date(t).getTime();if(!isNaN(s))return s;try{const r=t.includes("오후")||t.toLowerCase().includes("pm"),n=t.includes("오전")||t.toLowerCase().includes("am"),a=t.match(/\d+/g);if(!a||a.length<3)return 0;let l=parseInt(a[0],10),x=parseInt(a[1],10)-1,m=parseInt(a[2],10),h=0,M=0,L=0;return a.length>=4&&(h=parseInt(a[3],10)),a.length>=5&&(M=parseInt(a[4],10)),a.length>=6&&(L=parseInt(a[5],10)),r&&h<12&&(h+=12),n&&h===12&&(h=0),new Date(l,x,m,h,M,L).getTime()}catch{return 0}},g=t=>{const s=y.find(r=>String(r.id)===String(t));return s?s.title:`(ID: ${t})`},A=i.useMemo(()=>{const s=Array.from(new Set(o.map(r=>r["Landing ID"]))).map(r=>({id:String(r),title:g(String(r))}));return s.sort((r,n)=>r.title.localeCompare(n.title)),s},[o,y]),p=i.useMemo(()=>{let t=[...o];return u!=="all"&&(t=t.filter(s=>String(s["Landing ID"])===u)),d&&(t=t.filter(s=>{const r=s.Timestamp,n=N(r);if(!n)return!1;const a=new Date(n),l=a.getFullYear(),x=String(a.getMonth()+1).padStart(2,"0"),m=String(a.getDate()).padStart(2,"0");return`${l}-${x}-${m}`===d})),t.sort((s,r)=>{if(j==="timestamp"){const n=N(s.Timestamp),a=N(r.Timestamp);return f==="desc"?a-n:n-a}else if(j==="title"){const n=g(String(s["Landing ID"]))||"",a=g(String(r["Landing ID"]))||"";return f==="asc"?n.localeCompare(a):a.localeCompare(n)}return 0}),t},[o,y,u,d,f,j]),B=(t,s)=>new Date(t,s+1,0).getDate(),Y=(t,s)=>new Date(t,s,1).getDay(),E=()=>{const t=c.getFullYear(),s=c.getMonth(),r=B(t,s),n=Y(t,s),a=[];for(let l=0;l<n;l++)a.push(e.jsx("div",{className:"h-8 w-8"},`empty-${l}`));for(let l=1;l<=r;l++){const x=`${t}-${String(s+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,m=d===x;a.push(e.jsx("button",{onClick:()=>{D(m?null:x),S(!1)},className:`h-8 w-8 rounded-full text-xs font-bold flex items-center justify-center relative
                    ${m?"bg-blue-600 text-white":"hover:bg-gray-100 text-gray-700"}
                `,children:l},l))}return a},V=()=>I(new Date(c.getFullYear(),c.getMonth()-1,1)),z=()=>I(new Date(c.getFullYear(),c.getMonth()+1,1));return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 md:px-8 py-4 md:py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(q,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-base md:text-xl font-bold",children:"유입 경로 상세"})]}),e.jsxs("button",{onClick:C,className:"flex items-center px-3 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-xs md:text-sm font-bold",children:[e.jsx(H,{className:`w-4 h-4 mr-1 md:mr-2 ${b?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"새로고침"})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-4 md:p-8",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 md:p-4 mb-4 md:mb-6 shadow-sm relative",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap md:items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:"필터:"})]}),e.jsxs("select",{value:u,onChange:t=>F(t.target.value),className:"w-full md:w-auto border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"전체 랜딩페이지"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",t.id,")"]},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>S(!v),className:`w-full md:w-auto flex items-center justify-center gap-2 px-3 py-2 border rounded-lg text-sm ${d?"bg-blue-50 border-blue-200 text-blue-700 font-bold":"border-gray-300 text-gray-700"}`,children:[e.jsx(J,{className:"w-4 h-4"}),d||"날짜 선택",d&&e.jsx(K,{className:"w-3 h-3 hover:text-red-500",onClick:t=>{t.stopPropagation(),D(null)}})]}),v&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-xl p-4 z-50 w-64 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:V,className:"p-1 hover:bg-gray-100 rounded",children:"<"}),e.jsxs("span",{className:"text-sm font-bold",children:[c.getFullYear(),"년 ",c.getMonth()+1,"월"]}),e.jsx("button",{onClick:z,className:"p-1 hover:bg-gray-100 rounded",children:">"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["일","월","화","수","목","금","토"].map(t=>e.jsx("div",{className:"text-xs text-gray-400 font-bold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:E()})]})]}),e.jsx("div",{className:"hidden md:block w-px h-6 bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:"정렬:"}),e.jsxs("select",{value:j,onChange:t=>P(t.target.value),className:"border border-gray-300 rounded-lg px-2 py-1 text-xs md:text-sm outline-none",children:[e.jsx("option",{value:"timestamp",children:"시간순"}),e.jsx("option",{value:"title",children:"페이지 제목순"})]}),e.jsx("button",{onClick:()=>O(t=>t==="desc"?"asc":"desc"),className:"px-2 md:px-3 py-1 rounded text-xs md:text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold",children:f==="desc"?"▼":"▲"})]}),e.jsxs("div",{className:"md:ml-auto text-xs md:text-sm text-gray-500 text-right",children:["총 ",e.jsx("strong",{children:p.length}),"건"]})]})}),e.jsxs("div",{className:"md:hidden space-y-3",children:[p.map((t,s)=>{const r=g(String(t["Landing ID"]));return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.Timestamp}),e.jsxs("span",{className:"bg-gray-100 px-2 py-0.5 rounded text-xs font-bold text-gray-600",children:["ID: ",t["Landing ID"]]})]}),e.jsx("h3",{className:"font-bold text-blue-600 text-sm mb-2",children:r}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[t.Device==="Mobile"?e.jsx(k,{className:"w-3 h-3 text-orange-500"}):e.jsx($,{className:"w-3 h-3 text-blue-500"}),t.Device]}),e.jsxs("div",{className:"text-gray-500",children:[t.OS," / ",t.Browser]}),e.jsx("div",{className:"font-mono text-[10px] text-gray-400",children:t.IP}),e.jsx("div",{className:"truncate max-w-[150px]",title:t.Referrer,children:t.Referrer==="Direct"?"직접 접속":t.Referrer})]})]},s)}),!b&&p.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-10",children:o.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})]}),e.jsx("div",{className:"hidden md:block bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"날짜"}),e.jsx("th",{className:"px-6 py-3",children:"페이지 (Title)"}),e.jsx("th",{className:"px-6 py-3",children:"기기"}),e.jsx("th",{className:"px-6 py-3",children:"OS/브라우저"}),e.jsx("th",{className:"px-6 py-3",children:"IP"}),e.jsx("th",{className:"px-6 py-3",children:"유입경로"}),e.jsx("th",{className:"px-6 py-3",children:"랜딩ID"})]})}),e.jsxs("tbody",{children:[p.map((t,s)=>{const r=g(String(t["Landing ID"]));return e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.Timestamp}),e.jsx("td",{className:"px-6 py-4 font-bold text-blue-600",children:r}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.Device==="Mobile"?e.jsx(k,{className:"w-4 h-4 text-orange-500"}):e.jsx($,{className:"w-4 h-4 text-blue-500"}),t.Device]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:"mr-2 text-gray-800 font-medium",children:t.OS}),e.jsx("span",{className:"text-gray-400",children:t.Browser})]}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:t.IP}),e.jsx("td",{className:"px-6 py-4 max-w-xs truncate",title:t.Referrer,children:t.Referrer==="Direct"?e.jsx("span",{className:"text-gray-400",children:"직접 접속/없음"}):e.jsx("a",{href:t.Referrer,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:t.Referrer})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-bold",children:t["Landing ID"]})})]},s)}),!b&&p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-gray-400",children:o.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})})]})]})})})]})]})};export{ne as default};
