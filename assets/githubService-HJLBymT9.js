const i="markjin9981",u="landing-factory",p="main",m="landing_admin_gh_token",w=e=>{localStorage.setItem(m,e)},g=()=>{const e=localStorage.getItem(m);return e||""},$=async e=>{const n=g();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다. 설정 메뉴에서 토큰을 입력해주세요."};try{const s=(await y(e)).split(",")[1],t=Date.now(),o=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),c=`public/uploads/${t}_${o}`,l=`https://api.github.com/repos/${i}/${u}/contents/${c}`,r=await fetch(l,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`upload: ${o}`,content:s,branch:p})});if(!r.ok){const d=await r.json();throw new Error(d.message||"Github Upload Failed")}return{success:!0,url:`https://raw.githubusercontent.com/${i}/${u}/${p}/${c}`}}catch(a){return console.error("GitHub Upload Error:",a),{success:!1,message:a.message}}},T=async e=>{const n=g();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const s=`https://api.github.com/repos/${i}/${u}/contents/data/landingConfigs.json`;try{const t=await fetch(s,{headers:{Authorization:`Bearer ${n}`}});let o="";t.ok&&(o=(await t.json()).sha);const c=JSON.stringify(e,null,2),l=btoa(unescape(encodeURIComponent(c))),r=await fetch(s,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`deploy: Update landing configs (${Object.keys(e).length} pages)`,content:l,sha:o||void 0,branch:p})});if(!r.ok){const h=await r.json();throw new Error(h.message)}return{success:!0,message:"설정이 저장되고 배포가 시작되었습니다. (약 1~2분 소요)"}}catch(t){return console.error("GitHub Deploy Error:",t),{success:!1,message:t.message}}},E=async e=>{const n=g();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const s=`https://api.github.com/repos/${i}/${u}/contents/data/landingConfigs.json`;try{const t=await fetch(s,{headers:{Authorization:`Bearer ${n}`}});if(!t.ok)throw new Error("Failed to fetch existing configs");const o=await t.json(),c=o.sha,l=decodeURIComponent(escape(window.atob(o.content.replace(/\n/g,"")))),r=JSON.parse(l);if(!r[e])return{success:!0,message:"Already deleted or not found."};delete r[e];const h=JSON.stringify(r,null,2),d=btoa(unescape(encodeURIComponent(h))),f=await fetch(s,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove landing config ${e}`,content:d,sha:c,branch:p})});if(!f.ok){const b=await f.json();throw new Error(b.message)}return{success:!0,message:"GitHub에서도 삭제되었습니다."}}catch(t){return console.error("GitHub Delete Error:",t),{success:!1,message:t.message}}},y=e=>new Promise((n,a)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>n(s.result),s.onerror=t=>a(t)}),k=async()=>{const e=g();if(!e)return[];const a=`https://api.github.com/repos/${i}/${u}/contents/public/uploads`;try{const s=await fetch(a,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok){if(s.status===404)return[];throw new Error("Failed to fetch images")}const t=await s.json();return Array.isArray(t)?t.filter(o=>o.type==="file"&&o.name.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)).map(o=>({name:o.name,path:o.path,sha:o.sha,size:o.size,url:o.html_url,download_url:o.download_url,type:o.type})):[]}catch(s){return console.error("Fetch Images Error:",s),[]}},U=async(e,n)=>{const a=g();if(!a)return!1;const s=`https://api.github.com/repos/${i}/${u}/contents/${e}`;try{return(await fetch(s,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove image ${e}`,sha:n,branch:p})})).ok}catch(t){return console.error("Delete Image Error:",t),!1}};export{U as a,T as b,E as d,k as f,g,w as s,$ as u};
