import{c as F,u as J,d as Q,r as o,j as e,a as $,o as X,R as Z,p as ee,m as se,f as te,q as ae}from"./index-CvD2a9PU.js";import{A as re}from"./arrow-left-HYQ6Jhat.js";import{R as ne}from"./refresh-cw-B60TezVu.js";import{T as q}from"./trash-2-DajmGYDu.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=F("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),L=d=>{if(!d||typeof d!="string")return 0;const j=new Date(d).getTime();if(!isNaN(j))return j;try{const l=d.match(/\d+/g);if(!l||l.length<3)return 0;let D=parseInt(l[0],10),i=parseInt(l[1],10)-1,T=parseInt(l[2],10),g=0,f=0;return l.length>=4&&(g=parseInt(l[3],10)),l.length>=5&&(f=parseInt(l[4],10)),(d.includes("오후")||d.toLowerCase().includes("pm"))&&g<12&&(g+=12),new Date(D,i,T,g,f).getTime()}catch{return 0}},ie=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],pe=()=>{const{id:d}=J(),j=Q(),[l,D]=o.useState([]),[i,T]=o.useState(null),[g,f]=o.useState(!0),[w,K]=o.useState(""),[I,O]=o.useState("desc"),[N,H]=o.useState(""),[v,U]=o.useState(""),[x,S]=o.useState(1),C=10,[c,p]=o.useState(new Set),[h,B]=o.useState(!1),[de,ce]=o.useState(!1),[y,k]=o.useState(0),[P,z]=o.useState(!1),_=async()=>{f(!0),p(new Set);try{const[s,t]=await Promise.all([se(),te()]),a=t.find(n=>String(n.id)===String(d));T(a||null);const r=s.filter(n=>String(n["Landing ID"])===String(d));D(r)}catch(s){console.error(s)}finally{f(!1)}};o.useEffect(()=>{_()},[d]);const E=o.useMemo(()=>{let s=[...l];if(w){const t=w.toLowerCase();s=s.filter(a=>{const r=String(a.Name||"").toLowerCase(),n=String(a.Phone||"").toLowerCase();return r.includes(t)||n.includes(t)})}if(N){const t=new Date(N).setHours(0,0,0,0);s=s.filter(a=>L(a.Timestamp)>=t)}if(v){const t=new Date(v).setHours(23,59,59,999);s=s.filter(a=>L(a.Timestamp)<=t)}return s.sort((t,a)=>{const r=L(t.Timestamp),n=L(a.Timestamp);return I==="desc"?n-r:r-n}),s},[l,w,N,v,I]),b=Math.ceil(E.length/C),u=E.slice((x-1)*C,x*C),{columns:R,extraKeys:M}=o.useMemo(()=>{var r;const s=[{key:"Timestamp",label:"시간"}],t=new Set(["Timestamp","Landing ID"]);(r=i==null?void 0:i.formConfig)!=null&&r.fields?i.formConfig.fields.forEach(n=>{s.push({key:n.id,label:n.label}),t.add(n.id),t.add(n.id.toLowerCase()),n.type==="address"&&t.add(`${n.id}_detail`)}):l.length>0&&(l[0].Name&&(s.push({key:"Name",label:"이름"}),t.add("Name")),l[0].Phone&&(s.push({key:"Phone",label:"연락처"}),t.add("Phone")));const a=new Set;return l.forEach(n=>{Object.keys(n).forEach(m=>{t.has(m)||t.has(m.toLowerCase())||ie.includes(m.toLowerCase())||m.startsWith("consent_")||a.add(m)})}),a.has("Memo")&&(a.delete("Memo"),s.push({key:"Memo",label:"메모"})),{columns:s,extraKeys:Array.from(a)}},[i,l]),G=s=>{const t=new Set(c);t.has(s)?t.delete(s):t.add(s),p(t)},V=()=>{if(c.size===u.length)p(new Set);else{const s=new Set;u.forEach((t,a)=>s.add(a)),p(s)}},W=()=>{c.size!==0&&k(1)},Y=async()=>{if(y===1){k(2);return}z(!0);const t=Array.from(c).map(r=>u[r]).map(r=>({timestamp:r.Timestamp,landing_id:r["Landing ID"],name:r.Name,phone:r.Phone})),a=await ae(t);a.result==="success"?(await _(),k(0),p(new Set)):alert("삭제 실패: "+a.message),z(!1)};return g?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx($,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>j("/admin/stats"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(re,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[i?i.title:`페이지 ID: ${d}`,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full",children:[l.length,"건"]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:_,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," 새로고침"]})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 또는 전화번호 검색",value:w,onChange:s=>{K(s.target.value),S(1)},className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"text-gray-500",children:"기간:"}),e.jsx("input",{type:"date",value:N,onChange:s=>H(s.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:v,onChange:s=>U(s.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>O(s=>s==="desc"?"asc":"desc"),className:"flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 text-gray-700 font-bold",children:[e.jsx(le,{className:"w-4 h-4"}),I==="desc"?"최신순":"오래된순"]}),e.jsxs("button",{onClick:()=>{B(!h),p(new Set)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-colors ${h?"bg-red-50 text-red-600 border border-red-200":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(q,{className:"w-4 h-4"}),h?"삭제 취소":"항목 삭제"]}),h&&c.size>0&&e.jsxs("button",{onClick:W,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 shadow-sm animate-fade-in",children:[c.size,"개 삭제하기"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[h&&e.jsx("th",{className:"px-6 py-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:V,checked:c.size>0&&c.size===u.length,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),R.map(s=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:s.label},s.key)),M.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[u.map((s,t)=>e.jsxs("tr",{className:`hover:bg-blue-50/30 transition-colors ${h&&c.has(t)?"bg-red-50/50":""}`,children:[h&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:c.has(t),onChange:()=>G(t),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"})}),e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs text-center",children:E.length-((x-1)*C+t)}),R.map(a=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:(()=>{var n;const r=(n=i==null?void 0:i.formConfig)==null?void 0:n.fields.find(m=>m.id===a.key);if((r==null?void 0:r.type)==="address"){const m=s[a.key]||s[a.key.toLowerCase()]||"",A=s[`${a.key}_detail`]||s[`${a.key.toLowerCase()}_detail`]||"";return!m&&!A?"-":e.jsxs("div",{className:"whitespace-pre-wrap break-words min-w-[200px]",children:[m,A&&e.jsx("span",{className:"block text-gray-500 text-xs mt-0.5",children:A})]})}return s[a.key]||s[a.key.toLowerCase()]||"-"})()},a.key)),M.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:M.map(a=>{const r=s[a];return r?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-300",children:[a,":"]}),e.jsx("span",{children:r})]},a):null})})]},t)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-20 text-center text-gray-400 bg-gray-50/30",children:"데이터가 없습니다."})})]})]})})}),b>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("button",{onClick:()=>S(1),disabled:x===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(X,{className:"w-4 h-4"})}),Array.from({length:b},(s,t)=>t+1).filter(s=>s===1||s===b||Math.abs(s-x)<=2).map((s,t,a)=>{const r=a[t-1],n=r&&s-r>1;return e.jsxs(Z.Fragment,{children:[n&&e.jsx("span",{className:"text-gray-300",children:"..."}),e.jsx("button",{onClick:()=>S(s),className:`w-8 h-8 rounded-lg text-sm font-bold transition-all ${x===s?"bg-gray-900 text-white shadow-md transform scale-105":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:s})]},s)}),e.jsx("button",{onClick:()=>S(b),disabled:x===b,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(ee,{className:"w-4 h-4"})})]})]}),y>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-100",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:y===1?"선택한 항목 삭제":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep",children:y===1?e.jsxs(e.Fragment,{children:["총 ",e.jsxs("strong",{children:[c.size,"개"]}),"의 데이터를 삭제합니다.",e.jsx("br",{}),"계속 하시겠습니까?"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{children:"절대 복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(0),className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:Y,disabled:P,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:P?e.jsx($,{className:"w-5 h-5 animate-spin"}):y===1?"계속하기":"삭제 확정"})]})]})})]})};export{pe as default};
