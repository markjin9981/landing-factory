import{j as e}from"./animation-Dic0VY_j.js";import{u as s,e as t,r as a,R as r}from"./vendor-B42Fopx7.js";import{a as n,f as l,m as d}from"./googleSheetService-cfWdSa8H.js";import{c as i,L as o}from"./index-nvTOtYcA.js";import{A as c}from"./arrow-left-DRtibyGX.js";import{R as m}from"./refresh-cw-CDcaT94g.js";import{S as x}from"./search-DiaaKXNC.js";import{T as h}from"./trash-2-1Rs8O0SZ.js";import{C as g,a as p}from"./chevron-right-CWAa2xSo.js";import"./supabase-BnJ3Hf6T.js";
/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=i("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),y=e=>{if(!e||"string"!=typeof e)return 0;const s=new Date(e).getTime();if(!isNaN(s))return s;try{const s=e.match(/\d+/g);if(!s||s.length<3)return 0;let t=parseInt(s[0],10),a=parseInt(s[1],10)-1,r=parseInt(s[2],10),n=0,l=0;return s.length>=4&&(n=parseInt(s[3],10)),s.length>=5&&(l=parseInt(s[4],10)),(e.includes("오후")||e.toLowerCase().includes("pm"))&&n<12&&(n+=12),new Date(t,a,r,n,l).getTime()}catch(t){return 0}},f=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],b=()=>{const{id:i}=s(),b=t(),[j,w]=a.useState([]),[N,v]=a.useState(null),[k,C]=a.useState(!0),[S,L]=a.useState(""),[_,T]=a.useState("desc"),[z,D]=a.useState(""),[I,M]=a.useState(""),[P,$]=a.useState(1),[A,E]=a.useState(new Set),[F,H]=a.useState(!1),[K,R]=a.useState(!1),[q,O]=a.useState(0),[U,V]=a.useState(!1),W=async()=>{C(!0),E(new Set);try{const[e,s]=await Promise.all([n(),l()]),t=s.find(e=>String(e.id)===String(i));v(t||null);const a=e.filter(e=>String(e["Landing ID"])===String(i));w(a)}catch(e){}finally{C(!1)}};a.useEffect(()=>{W()},[i]);const B=a.useMemo(()=>{let e=[...j];if(S){const s=S.toLowerCase();e=e.filter(e=>{const t=String(e.Name||"").toLowerCase(),a=String(e.Phone||"").toLowerCase();return t.includes(s)||a.includes(s)})}if(z){const s=new Date(z).setHours(0,0,0,0);e=e.filter(e=>y(e.Timestamp)>=s)}if(I){const s=new Date(I).setHours(23,59,59,999);e=e.filter(e=>y(e.Timestamp)<=s)}return e.sort((e,s)=>{const t=y(e.Timestamp),a=y(s.Timestamp);return"desc"===_?a-t:t-a}),e},[j,S,z,I,_]),G=Math.ceil(B.length/10),J=B.slice(10*(P-1),10*P),{columns:Q,extraKeys:X}=a.useMemo(()=>{var e;const s=[{key:"Timestamp",label:"시간"}],t=new Set(["Timestamp","Landing ID"]);(null==(e=null==N?void 0:N.formConfig)?void 0:e.fields)?N.formConfig.fields.forEach(e=>{s.push({key:e.id,label:e.label}),t.add(e.id),t.add(e.id.toLowerCase()),"address"===e.type&&t.add(`${e.id}_detail`)}):j.length>0&&(j[0].Name&&(s.push({key:"Name",label:"이름"}),t.add("Name")),j[0].Phone&&(s.push({key:"Phone",label:"연락처"}),t.add("Phone")));const a=new Set;return j.forEach(e=>{Object.keys(e).forEach(e=>{t.has(e)||t.has(e.toLowerCase())||f.includes(e.toLowerCase())||e.startsWith("consent_")||a.add(e)})}),a.has("Memo")&&(a.delete("Memo"),s.push({key:"Memo",label:"메모"})),{columns:s,extraKeys:Array.from(a)}},[N,j]),Y=e=>{const s=new Set(A);s.has(e)?s.delete(e):s.add(e),E(s)},Z=()=>{if(A.size===J.length)E(new Set);else{const e=new Set;J.forEach((s,t)=>e.add(t)),E(e)}};return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(o,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-8 md:py-5 flex flex-col md:flex-row items-center justify-between sticky top-0 z-10 shadow-sm gap-4 md:gap-0",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("button",{onClick:()=>b("/admin/stats"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(c,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"min-w-0",children:e.jsxs("h1",{className:"text-lg md:text-xl font-bold flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:N?N.title:`페이지 ID: ${i}`}),e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full shrink-0",children:[j.length,"건"]})]})})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:e.jsxs("button",{onClick:W,className:"flex-1 md:flex-none justify-center items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(m,{className:"w-4 h-4 mr-2"})," 새로고침"]})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row gap-4 items-stretch md:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(x,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 또는 전화번호 검색",value:S,onChange:e=>{L(e.target.value),$(1)},className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-full md:w-64"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200 w-full md:w-auto",children:[e.jsx("span",{className:"text-gray-500 shrink-0",children:"기간:"}),e.jsx("input",{type:"date",value:z,onChange:e=>D(e.target.value),className:"bg-transparent outline-none text-gray-700 font-medium w-full"}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:I,onChange:e=>M(e.target.value),className:"bg-transparent outline-none text-gray-700 font-medium w-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>T(e=>"desc"===e?"asc":"desc"),className:"flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 text-gray-700 font-bold",children:[e.jsx(u,{className:"w-4 h-4"}),"desc"===_?"최신순":"오래된순"]}),e.jsxs("button",{onClick:()=>{H(!F),E(new Set)},className:"flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-colors "+(F?"bg-red-50 text-red-600 border border-red-200":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-50"),children:[e.jsx(h,{className:"w-4 h-4"}),F?"취소":"삭제"]}),F&&A.size>0&&e.jsxs("button",{onClick:()=>{0!==A.size&&O(1)},className:"col-span-2 md:col-span-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 shadow-sm animate-fade-in",children:[A.size,"개 삭제하기"]})]})]}),e.jsxs("div",{className:"bg-white border md:border-gray-200 rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[F&&e.jsx("th",{className:"px-6 py-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:Z,checked:A.size>0&&A.size===J.length,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),Q.map(s=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:s.label},s.key)),X.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[J.map((s,t)=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors "+(F&&A.has(t)?"bg-red-50/50":""),children:[F&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:A.has(t),onChange:()=>Y(t),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"})}),e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs text-center",children:B.length-(10*(P-1)+t)}),Q.map(t=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:(()=>{var a;const r=null==(a=null==N?void 0:N.formConfig)?void 0:a.fields.find(e=>e.id===t.key);if("address"===(null==r?void 0:r.type)){const a=s[t.key]||s[t.key.toLowerCase()]||"",r=s[`${t.key}_detail`]||s[`${t.key.toLowerCase()}_detail`]||"";return a||r?e.jsxs("div",{className:"whitespace-pre-wrap break-words min-w-[200px]",children:[a,r&&e.jsx("span",{className:"block text-gray-500 text-xs mt-0.5",children:r})]}):"-"}return s[t.key]||s[t.key.toLowerCase()]||"-"})()},t.key)),X.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:X.map(t=>{const a=s[t];return a?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-300",children:[t,":"]}),e.jsx("span",{children:a})]},t):null})})]},t)),0===J.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-20 text-center text-gray-400 bg-gray-50/30",children:"데이터가 없습니다."})})]})]})}),e.jsxs("div",{className:"md:hidden divide-y divide-gray-100",children:[F&&e.jsxs("div",{className:"p-3 bg-red-50 flex items-center gap-2 border-b border-red-100",children:[e.jsx("input",{type:"checkbox",onChange:Z,checked:A.size>0&&A.size===J.length,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-xs font-bold text-red-700",children:["전체 선택 (",J.length,")"]})]}),J.map((s,t)=>e.jsx("div",{className:"p-4 transition-colors "+(F&&A.has(t)?"bg-red-50/30":"bg-white"),onClick:()=>F&&Y(t),children:e.jsxs("div",{className:"flex items-start gap-3",children:[F&&e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"checkbox",checked:A.has(t),onChange:()=>Y(t),className:"rounded border-gray-300 text-red-600 focus:ring-red-500 pointer-events-none"})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",B.length-(10*(P-1)+t)]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:s.Timestamp||"-"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:Q.filter(e=>"Timestamp"!==e.key).map(t=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:t.label}),e.jsx("span",{className:"text-sm "+("Phone"===t.key?"text-blue-600 font-bold":"text-gray-900"),children:(()=>{var a;const r=null==(a=null==N?void 0:N.formConfig)?void 0:a.fields.find(e=>e.id===t.key);if("address"===(null==r?void 0:r.type)){const a=s[t.key]||s[t.key.toLowerCase()]||"",r=s[`${t.key}_detail`]||s[`${t.key.toLowerCase()}_detail`]||"";return e.jsxs("span",{children:[a," ",r]})}return s[t.key]||s[t.key.toLowerCase()]||"-"})()})]},t.key))}),X.length>0&&e.jsx("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-600 space-y-1 mt-2",children:X.map(t=>{const a=s[t];return a?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold text-gray-400",children:t}),e.jsx("span",{children:a})]},t):null})})]})]})},t)),0===J.length&&e.jsx("div",{className:"p-10 text-center text-gray-400",children:"데이터가 없습니다."})]})]}),G>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("button",{onClick:()=>$(1),disabled:1===P,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(g,{className:"w-4 h-4"})}),Array.from({length:G},(e,s)=>s+1).filter(e=>1===e||e===G||Math.abs(e-P)<=2).map((s,t,a)=>{const n=a[t-1],l=n&&s-n>1;return e.jsxs(r.Fragment,{children:[l&&e.jsx("span",{className:"text-gray-300",children:"..."}),e.jsx("button",{onClick:()=>$(s),className:"w-8 h-8 rounded-lg text-sm font-bold transition-all "+(P===s?"bg-gray-900 text-white shadow-md transform scale-105":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"),children:s})]},s)}),e.jsx("button",{onClick:()=>$(G),disabled:P===G,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(p,{className:"w-4 h-4"})})]})]}),q>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-100",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(h,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:1===q?"선택한 항목 삭제":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep",children:1===q?e.jsxs(e.Fragment,{children:["총 ",e.jsxs("strong",{children:[A.size,"개"]}),"의 데이터를 삭제합니다.",e.jsx("br",{}),"계속 하시겠습니까?"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{children:"절대 복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>O(0),className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:async()=>{if(1===q)return void O(2);V(!0);const e=Array.from(A).map(e=>J[e]).map(e=>({timestamp:e.Timestamp,landing_id:e["Landing ID"],name:e.Name,phone:e.Phone})),s=await d(e);"success"===s.result?(await W(),O(0),E(new Set)):alert("삭제 실패: "+s.message),V(!1)},disabled:U,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:U?e.jsx(o,{className:"w-5 h-5 animate-spin"}):1===q?"계속하기":"삭제 확정"})]})]})})]})};export{b as default};
