import{j as e}from"./animation-BOIIKJnC.js";import{b as Y,u as J,r as d,R as Q}from"./vendor-B_BVtOF2.js";import{c as X,L as K,x as Z,y as ee,a as se,f as te,z as ae}from"./index-DXltStGZ.js";import{A as re}from"./arrow-left-CrxIhJt2.js";import{R as ne}from"./refresh-cw-B-YTc0fY.js";import{S as le}from"./search-CLvNG3Ry.js";import{T as O}from"./trash-2-DJR2VZSp.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=X("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),_=m=>{if(!m||typeof m!="string")return 0;const v=new Date(m).getTime();if(!isNaN(v))return v;try{const l=m.match(/\d+/g);if(!l||l.length<3)return 0;let I=parseInt(l[0],10),i=parseInt(l[1],10)-1,A=parseInt(l[2],10),p=0,f=0;return l.length>=4&&(p=parseInt(l[3],10)),l.length>=5&&(f=parseInt(l[4],10)),(m.includes("오후")||m.toLowerCase().includes("pm"))&&p<12&&(p+=12),new Date(I,i,A,p,f).getTime()}catch{return 0}},ie=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],ye=()=>{const{id:m}=Y(),v=J(),[l,I]=d.useState([]),[i,A]=d.useState(null),[p,f]=d.useState(!0),[k,H]=d.useState(""),[E,U]=d.useState("desc"),[C,q]=d.useState(""),[S,B]=d.useState(""),[g,L]=d.useState(1),y=10,[o,u]=d.useState(new Set),[x,G]=d.useState(!1),[oe,ce]=d.useState(!1),[b,D]=d.useState(0),[$,R]=d.useState(!1),M=async()=>{f(!0),u(new Set);try{const[s,a]=await Promise.all([se(),te()]),t=a.find(n=>String(n.id)===String(m));A(t||null);const r=s.filter(n=>String(n["Landing ID"])===String(m));I(r)}catch(s){console.error(s)}finally{f(!1)}};d.useEffect(()=>{M()},[m]);const T=d.useMemo(()=>{let s=[...l];if(k){const a=k.toLowerCase();s=s.filter(t=>{const r=String(t.Name||"").toLowerCase(),n=String(t.Phone||"").toLowerCase();return r.includes(a)||n.includes(a)})}if(C){const a=new Date(C).setHours(0,0,0,0);s=s.filter(t=>_(t.Timestamp)>=a)}if(S){const a=new Date(S).setHours(23,59,59,999);s=s.filter(t=>_(t.Timestamp)<=a)}return s.sort((a,t)=>{const r=_(a.Timestamp),n=_(t.Timestamp);return E==="desc"?n-r:r-n}),s},[l,k,C,S,E]),j=Math.ceil(T.length/y),h=T.slice((g-1)*y,g*y),{columns:P,extraKeys:w}=d.useMemo(()=>{var r;const s=[{key:"Timestamp",label:"시간"}],a=new Set(["Timestamp","Landing ID"]);(r=i==null?void 0:i.formConfig)!=null&&r.fields?i.formConfig.fields.forEach(n=>{s.push({key:n.id,label:n.label}),a.add(n.id),a.add(n.id.toLowerCase()),n.type==="address"&&a.add(`${n.id}_detail`)}):l.length>0&&(l[0].Name&&(s.push({key:"Name",label:"이름"}),a.add("Name")),l[0].Phone&&(s.push({key:"Phone",label:"연락처"}),a.add("Phone")));const t=new Set;return l.forEach(n=>{Object.keys(n).forEach(c=>{a.has(c)||a.has(c.toLowerCase())||ie.includes(c.toLowerCase())||c.startsWith("consent_")||t.add(c)})}),t.has("Memo")&&(t.delete("Memo"),s.push({key:"Memo",label:"메모"})),{columns:s,extraKeys:Array.from(t)}},[i,l]),z=s=>{const a=new Set(o);a.has(s)?a.delete(s):a.add(s),u(a)},F=()=>{if(o.size===h.length)u(new Set);else{const s=new Set;h.forEach((a,t)=>s.add(t)),u(s)}},V=()=>{o.size!==0&&D(1)},W=async()=>{if(b===1){D(2);return}R(!0);const a=Array.from(o).map(r=>h[r]).map(r=>({timestamp:r.Timestamp,landing_id:r["Landing ID"],name:r.Name,phone:r.Phone})),t=await ae(a);t.result==="success"?(await M(),D(0),u(new Set)):alert("삭제 실패: "+t.message),R(!1)};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(K,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-8 md:py-5 flex flex-col md:flex-row items-center justify-between sticky top-0 z-10 shadow-sm gap-4 md:gap-0",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("button",{onClick:()=>v("/admin/stats"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(re,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"min-w-0",children:e.jsxs("h1",{className:"text-lg md:text-xl font-bold flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:i?i.title:`페이지 ID: ${m}`}),e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full shrink-0",children:[l.length,"건"]})]})})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:e.jsxs("button",{onClick:M,className:"flex-1 md:flex-none justify-center items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," 새로고침"]})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row gap-4 items-stretch md:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(le,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 또는 전화번호 검색",value:k,onChange:s=>{H(s.target.value),L(1)},className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-full md:w-64"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200 w-full md:w-auto",children:[e.jsx("span",{className:"text-gray-500 shrink-0",children:"기간:"}),e.jsx("input",{type:"date",value:C,onChange:s=>q(s.target.value),className:"bg-transparent outline-none text-gray-700 font-medium w-full"}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:S,onChange:s=>B(s.target.value),className:"bg-transparent outline-none text-gray-700 font-medium w-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>U(s=>s==="desc"?"asc":"desc"),className:"flex items-center justify-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 text-gray-700 font-bold",children:[e.jsx(de,{className:"w-4 h-4"}),E==="desc"?"최신순":"오래된순"]}),e.jsxs("button",{onClick:()=>{G(!x),u(new Set)},className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-colors ${x?"bg-red-50 text-red-600 border border-red-200":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(O,{className:"w-4 h-4"}),x?"취소":"삭제"]}),x&&o.size>0&&e.jsxs("button",{onClick:V,className:"col-span-2 md:col-span-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 shadow-sm animate-fade-in",children:[o.size,"개 삭제하기"]})]})]}),e.jsxs("div",{className:"bg-white border md:border-gray-200 rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[x&&e.jsx("th",{className:"px-6 py-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:F,checked:o.size>0&&o.size===h.length,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),P.map(s=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:s.label},s.key)),w.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[h.map((s,a)=>e.jsxs("tr",{className:`hover:bg-blue-50/30 transition-colors ${x&&o.has(a)?"bg-red-50/50":""}`,children:[x&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:o.has(a),onChange:()=>z(a),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"})}),e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs text-center",children:T.length-((g-1)*y+a)}),P.map(t=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:(()=>{var n;const r=(n=i==null?void 0:i.formConfig)==null?void 0:n.fields.find(c=>c.id===t.key);if((r==null?void 0:r.type)==="address"){const c=s[t.key]||s[t.key.toLowerCase()]||"",N=s[`${t.key}_detail`]||s[`${t.key.toLowerCase()}_detail`]||"";return!c&&!N?"-":e.jsxs("div",{className:"whitespace-pre-wrap break-words min-w-[200px]",children:[c,N&&e.jsx("span",{className:"block text-gray-500 text-xs mt-0.5",children:N})]})}return s[t.key]||s[t.key.toLowerCase()]||"-"})()},t.key)),w.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:w.map(t=>{const r=s[t];return r?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-300",children:[t,":"]}),e.jsx("span",{children:r})]},t):null})})]},a)),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-20 text-center text-gray-400 bg-gray-50/30",children:"데이터가 없습니다."})})]})]})}),e.jsxs("div",{className:"md:hidden divide-y divide-gray-100",children:[x&&e.jsxs("div",{className:"p-3 bg-red-50 flex items-center gap-2 border-b border-red-100",children:[e.jsx("input",{type:"checkbox",onChange:F,checked:o.size>0&&o.size===h.length,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-xs font-bold text-red-700",children:["전체 선택 (",h.length,")"]})]}),h.map((s,a)=>e.jsx("div",{className:`p-4 transition-colors ${x&&o.has(a)?"bg-red-50/30":"bg-white"}`,onClick:()=>x&&z(a),children:e.jsxs("div",{className:"flex items-start gap-3",children:[x&&e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"checkbox",checked:o.has(a),onChange:()=>z(a),className:"rounded border-gray-300 text-red-600 focus:ring-red-500 pointer-events-none"})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",T.length-((g-1)*y+a)]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:s.Timestamp||"-"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:P.filter(t=>t.key!=="Timestamp").map(t=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:t.label}),e.jsx("span",{className:`text-sm ${t.key==="Phone"?"text-blue-600 font-bold":"text-gray-900"}`,children:(()=>{var n;const r=(n=i==null?void 0:i.formConfig)==null?void 0:n.fields.find(c=>c.id===t.key);if((r==null?void 0:r.type)==="address"){const c=s[t.key]||s[t.key.toLowerCase()]||"",N=s[`${t.key}_detail`]||s[`${t.key.toLowerCase()}_detail`]||"";return e.jsxs("span",{children:[c," ",N]})}return s[t.key]||s[t.key.toLowerCase()]||"-"})()})]},t.key))}),w.length>0&&e.jsx("div",{className:"bg-gray-50 p-2 rounded text-xs text-gray-600 space-y-1 mt-2",children:w.map(t=>{const r=s[t];return r?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold text-gray-400",children:t}),e.jsx("span",{children:r})]},t):null})})]})]})},a)),h.length===0&&e.jsx("div",{className:"p-10 text-center text-gray-400",children:"데이터가 없습니다."})]})]}),j>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("button",{onClick:()=>L(1),disabled:g===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(Z,{className:"w-4 h-4"})}),Array.from({length:j},(s,a)=>a+1).filter(s=>s===1||s===j||Math.abs(s-g)<=2).map((s,a,t)=>{const r=t[a-1],n=r&&s-r>1;return e.jsxs(Q.Fragment,{children:[n&&e.jsx("span",{className:"text-gray-300",children:"..."}),e.jsx("button",{onClick:()=>L(s),className:`w-8 h-8 rounded-lg text-sm font-bold transition-all ${g===s?"bg-gray-900 text-white shadow-md transform scale-105":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:s})]},s)}),e.jsx("button",{onClick:()=>L(j),disabled:g===j,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(ee,{className:"w-4 h-4"})})]})]}),b>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-100",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:b===1?"선택한 항목 삭제":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep",children:b===1?e.jsxs(e.Fragment,{children:["총 ",e.jsxs("strong",{children:[o.size,"개"]}),"의 데이터를 삭제합니다.",e.jsx("br",{}),"계속 하시겠습니까?"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{children:"절대 복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(0),className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:W,disabled:$,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:$?e.jsx(K,{className:"w-5 h-5 animate-spin"}):b===1?"계속하기":"삭제 확정"})]})]})})]})};export{ye as default};
