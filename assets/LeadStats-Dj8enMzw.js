import{r as h,d as D,j as e,a as L,L as k,k as E,f as T}from"./index-BUMd2zyg.js";import{A as _}from"./arrow-left-AHjN8XjR.js";import{R as S}from"./refresh-cw-BbVbd-ac.js";import{L as I}from"./log-out-D1SiIP4M.js";import{C as M}from"./calendar-DgrAzpr-.js";import{D as v}from"./database-nb-6s2Q1.js";const K=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],b=o=>{if(!o||typeof o!="string")return 0;const p=new Date(o).getTime();if(!isNaN(p))return p;try{const n=o.match(/\d+/g);if(!n||n.length<3)return 0;let u=parseInt(n[0],10),y=parseInt(n[1],10)-1,f=parseInt(n[2],10),x=0,g=0;return n.length>=4&&(x=parseInt(n[3],10)),n.length>=5&&(g=parseInt(n[4],10)),(o.includes("오후")||o.toLowerCase().includes("pm"))&&x<12&&(x+=12),new Date(u,y,f,x,g).getTime()}catch{return 0}},z=()=>{const[o,p]=h.useState([]),[n,u]=h.useState([]),[y,f]=h.useState(!0),x=D(),g=async()=>{f(!0);try{const[s,t]=await Promise.all([E(),T()]);p(s),u(t)}catch(s){console.error(s)}finally{f(!1)}};h.useEffect(()=>{g()},[]);const j=h.useMemo(()=>{const s={};return o.forEach(t=>{const a=String(t["Landing ID"]||"unknown");s[a]||(s[a]=[]),s[a].push(t)}),Object.keys(s).forEach(t=>{s[t].sort((a,i)=>b(i.Timestamp)-b(a.Timestamp))}),s},[o]),N=h.useMemo(()=>{const s=new Date;s.setHours(0,0,0,0);const t=s.getTime();let a=0,i=o.length;return o.forEach(c=>{b(c.Timestamp)>=t&&a++}),{todayCount:a,totalCount:i}},[o]),C=(s,t)=>{var d;const a=n.find(r=>String(r.id)===s),i=[{key:"Timestamp",label:"시간"}],c=new Set(["Timestamp","Landing ID"]);if((d=a==null?void 0:a.formConfig)!=null&&d.fields)a.formConfig.fields.forEach(r=>{i.push({key:r.id,label:r.label}),c.add(r.id),c.add(r.id.toLowerCase())});else if(t.length>0){const r=t[0];r.Name&&(i.push({key:"Name",label:"이름"}),c.add("Name")),r.Phone&&(i.push({key:"Phone",label:"연락처"}),c.add("Phone"))}const m=new Set;return t.forEach(r=>{Object.keys(r).forEach(l=>{c.has(l)||c.has(l.toLowerCase())||K.includes(l.toLowerCase())||l.startsWith("consent_")||m.add(l)})}),m.has("Memo")&&(m.delete("Memo"),i.push({key:"Memo",label:"메모"})),{columns:i,extraKeys:Array.from(m)}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(L,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(_,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-bold",children:"DB 수집 현황"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:g,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(S,{className:"w-4 h-4 mr-2"})," 새로고침"]}),e.jsxs("button",{onClick:()=>{sessionStorage.removeItem("admin_auth"),x("/admin/login")},className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-bold",children:[e.jsx(I,{className:"w-4 h-4 mr-2"})," 로그아웃"]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(M,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"오늘 수집된 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[N.todayCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(v,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"누적 수집 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[N.totalCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]})]}),Object.keys(j).length===0?e.jsx("div",{className:"text-center py-20 bg-white rounded-xl border-dashed border-2 border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"수집된 데이터가 없습니다."})}):Object.entries(j).map(([s,t])=>{const a=n.find(d=>String(d.id)===s),i=a?a.title:`알 수 없는 페이지 (ID: ${s})`,{columns:c,extraKeys:m}=C(s,t);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white p-2 border border-gray-200 rounded-lg",children:e.jsx(v,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:i}),e.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:["ID: ",s]})]})]}),e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold",children:[t.length," 건"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),c.map(d=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:d.label},d.key)),m.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:t.map((d,r)=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:t.length-r}),c.map(l=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d[l.key]||d[l.key.toLowerCase()]||"-"},l.key)),m.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:m.map(l=>{const w=d[l];return w?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-400",children:[l,":"]}),e.jsx("span",{children:w})]},l):null})})]},r))})]})})]},s)})]})]})};export{z as default};
