import{c as Q,r as i,d as Z,j as e,L as ee,X as te,a as se,k as ae,f as ne,l as re}from"./index-CphRtFkO.js";import{A as le}from"./arrow-left-CL6gM6jh.js";import{R as oe}from"./refresh-cw-CaXu6YCn.js";import{L as ie}from"./log-out-3Qr0ITXv.js";import{F as ce,C as de}from"./filter-CPc34NRI.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Q("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),R=["marketing_consent","third_party_consent","referrer","user_agent","page_title","landing_id","timestamp","privacy_consent","raw data","recipient","body","subject"],me=({lead:r,promotedKey:j,promotedKey2:p})=>{const[N,l]=i.useState(!1),{Timestamp:w,"Landing ID":v,...g}=r,m=[],c=[],f=["name","phone","landing id","timestamp"];return j&&f.push(j.toLowerCase()),p&&f.push(p.toLowerCase()),Object.keys(g).forEach(a=>{const S=a.toLowerCase();R.includes(S)||S.startsWith("consent_")?c.push(a):f.includes(S)||(a.startsWith("f")&&!isNaN(Number(a[1]))?c.push(a):m.push(a))}),m.length===0&&c.length===0?e.jsx("span",{children:"-"}):e.jsxs("div",{className:"space-y-2",children:[m.length>0&&e.jsx("div",{className:"space-y-1",children:m.map(a=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-700 min-w-[60px]",children:[a,":"]}),e.jsx("span",{className:"text-gray-900 break-all",children:g[a]})]},a))}),c.length>0&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>l(!N),className:"flex items-center gap-1 text-[10px] text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded transition-colors",children:N?e.jsxs(e.Fragment,{children:["접기 ",e.jsx(xe,{className:"w-3 h-3"})]}):e.jsxs(e.Fragment,{children:["더보기 (",c.length,") ",e.jsx(re,{className:"w-3 h-3"})]})}),N&&e.jsx("div",{className:"mt-2 space-y-1 bg-gray-50 p-2 rounded border border-gray-100 animate-fade-in text-[10px]",children:c.map(a=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:gap-2 border-b border-gray-100 last:border-0 pb-1 last:pb-0",children:[e.jsxs("span",{className:"font-bold text-gray-500 w-24 shrink-0",children:[a,":"]}),e.jsx("span",{className:"text-gray-700 break-all font-mono",children:g[a]})]},a))})]})]})},_=r=>{if(!r||typeof r!="string")return 0;const j=new Date(r).getTime();if(!isNaN(j))return j;try{const p=r.includes("오후")||r.toLowerCase().includes("pm"),N=r.includes("오전")||r.toLowerCase().includes("am"),l=r.match(/\d+/g);if(!l||l.length<3)return 0;let w=parseInt(l[0],10),v=parseInt(l[1],10)-1,g=parseInt(l[2],10);if(v<0||v>11||g<1||g>31)return 0;let m=0,c=0,f=0;return l.length>=4&&(m=parseInt(l[3],10)),l.length>=5&&(c=parseInt(l[4],10)),l.length>=6&&(f=parseInt(l[5],10)),p&&m<12&&(m+=12),N&&m===12&&(m=0),new Date(w,v,g,m,c,f).getTime()}catch{return 0}},ye=()=>{const[r,j]=i.useState([]),[p,N]=i.useState([]),[l,w]=i.useState(!0),[v,g]=i.useState(!1),m=Z(),[c,f]=i.useState("all"),[a,S]=i.useState("desc"),[L,U]=i.useState("timestamp"),[y,$]=i.useState(null),[K,A]=i.useState(!1),[b,Y]=i.useState(new Date),O=async()=>{w(!0),g(!1);try{const[t,s]=await Promise.all([ae(),ne()]);j(t),N(s)}catch{g(!0)}finally{w(!1)}};i.useEffect(()=>{O()},[]);const W=()=>{sessionStorage.removeItem("admin_auth"),m("/admin/login")},C=t=>{const s=p.find(o=>String(o.id)===String(t));return s?s.title:`(ID: ${t})`},z=i.useMemo(()=>{const t=new Set(r.map(s=>s["Landing ID"]));return Array.from(t).sort().map(s=>({id:String(s),title:C(String(s))}))},[r,p]),D=i.useMemo(()=>{let t=[...r];return c!=="all"&&(t=t.filter(s=>String(s["Landing ID"])===c)),y&&(t=t.filter(s=>{const o=s.Timestamp,d=_(o);if(!d)return!1;const n=new Date(d),x=n.getFullYear(),h=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${x}-${h}-${u}`===y})),t=t.filter(s=>{const o=String(s["Landing ID"]||"");return C(o),!(!o||o.toLowerCase()==="undefined"||o.toLowerCase()==="unknown"||o.includes("Landing Factory"))}),t.sort((s,o)=>{if(L==="timestamp"){const d=_(s.Timestamp),n=_(o.Timestamp);return a==="desc"?n-d:d-n}else if(L==="title"){const d=C(String(s["Landing ID"]))||"",n=C(String(o["Landing ID"]))||"";return a==="asc"?d.localeCompare(n):n.localeCompare(d)}return 0}),t},[r,p,c,a,L,y]),[I,k]=i.useState(1),F=10;i.useEffect(()=>{k(1)},[c,y,L,a]);const T=Math.ceil(D.length/F),X=D.slice((I-1)*F,I*F),q=(t,s)=>new Date(t,s+1,0).getDate(),G=(t,s)=>new Date(t,s,1).getDay(),V=()=>{const t=b.getFullYear(),s=b.getMonth(),o=q(t,s),d=G(t,s),n=[];for(let x=0;x<d;x++)n.push(e.jsx("div",{className:"h-8 w-8"},`empty-${x}`));for(let x=1;x<=o;x++){const h=`${t}-${String(s+1).padStart(2,"0")}-${String(x).padStart(2,"0")}`,u=y===h,M=r.some(E=>{const B=_(E.Timestamp);if(!B)return!1;const P=new Date(B);return P.getFullYear()===t&&P.getMonth()===s&&P.getDate()===x});n.push(e.jsxs("button",{onClick:()=>{$(u?null:h),A(!1)},className:`h-8 w-8 rounded-full text-xs font-bold flex items-center justify-center relative
                    ${u?"bg-blue-600 text-white":"hover:bg-gray-100 text-gray-700"}
                `,children:[x,M&&!u&&e.jsx("span",{className:"absolute bottom-0.5 w-1 h-1 bg-red-500 rounded-full"})]},x))}return n},H=()=>Y(new Date(b.getFullYear(),b.getMonth()-1,1)),J=()=>Y(new Date(b.getFullYear(),b.getMonth()+1,1));return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ee,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(le,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-bold",children:"DB 수집 현황"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:O,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm font-bold",children:[e.jsx(oe,{className:`w-4 h-4 mr-2 ${l?"animate-spin":""}`}),"새로고침"]}),e.jsxs("button",{onClick:W,className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-bold",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"로그아웃"]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6 flex flex-wrap items-center gap-4 shadow-sm relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"필터:"})]}),e.jsxs("select",{value:c,onChange:t=>f(t.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none max-w-xs",children:[e.jsx("option",{value:"all",children:"전체 랜딩페이지"}),z.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",t.id,")"]},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>A(!K),className:`flex items-center gap-2 px-3 py-2 border rounded-lg text-sm ${y?"bg-blue-50 border-blue-200 text-blue-700 font-bold":"border-gray-300 text-gray-700"}`,children:[e.jsx(de,{className:"w-4 h-4"}),y||"날짜 선택",y&&e.jsx(te,{className:"w-3 h-3 hover:text-red-500",onClick:t=>{t.stopPropagation(),$(null)}})]}),K&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-xl p-4 z-50 w-64 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:H,className:"p-1 hover:bg-gray-100 rounded",children:"<"}),e.jsxs("span",{className:"text-sm font-bold",children:[b.getFullYear(),"년 ",b.getMonth()+1,"월"]}),e.jsx("button",{onClick:J,className:"p-1 hover:bg-gray-100 rounded",children:">"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["일","월","화","수","목","금","토"].map(t=>e.jsx("div",{className:"text-xs text-gray-400 font-bold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:V()})]})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2 hidden md:block"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"정렬:"}),e.jsxs("select",{value:L,onChange:t=>U(t.target.value),className:"border border-gray-300 rounded-lg px-2 py-1 text-sm outline-none",children:[e.jsx("option",{value:"timestamp",children:"시간순"}),e.jsx("option",{value:"title",children:"페이지 제목순"})]}),e.jsx("button",{onClick:()=>S(t=>t==="desc"?"asc":"desc"),className:"px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold",children:a==="desc"?"내림차순 (▼)":"오름차순 (▲)"})]}),e.jsxs("div",{className:"ml-auto text-sm text-gray-500",children:["총 ",e.jsx("strong",{children:D.length}),"건 조회됨"]})]}),l?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(se,{className:"w-10 h-10 text-gray-400 animate-spin"})}):e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"시간 (Timestamp)"}),e.jsx("th",{className:"px-6 py-3",children:"페이지 (Title)"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"ID"}),e.jsx("th",{className:"px-6 py-3",children:"이름"}),e.jsx("th",{className:"px-6 py-3",children:"연락처"}),e.jsx("th",{className:"px-6 py-3",children:"데이터1"}),e.jsx("th",{className:"px-6 py-3",children:"데이터2"}),e.jsx("th",{className:"px-6 py-3",children:"추가 정보"})]})}),e.jsxs("tbody",{children:[X.map((t,s)=>{const o=C(String(t["Landing ID"]));let d,n;const x=["timestamp","landing id","name","phone"],h=[];for(const u of Object.keys(t)){const M=u.toLowerCase();if(x.includes(M)||R.includes(M)||M.startsWith("consent_"))continue;const E=t[u];E==null||String(E).trim()===""||h.push(u)}return h.length>0&&(d=h[0]),h.length>1&&(n=h[1]),e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-xs text-gray-400",children:t.Timestamp}),e.jsx("td",{className:"px-6 py-4 font-bold text-blue-600",children:o}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-gray-100 text-gray-500 text-xs px-2 py-1 rounded",children:t["Landing ID"]})}),e.jsx("td",{className:"px-6 py-4 font-bold text-gray-900",children:t.Name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.Phone}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-800",children:d?t[d]:"-"}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-800",children:n?t[n]:"-"}),e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:e.jsx(me,{lead:t,promotedKey:d,promotedKey2:n})})]},s)}),D.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-10 text-center text-gray-400",children:r.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})})]})]})}),D.length>0&&e.jsxs("div",{className:"flex justify-center items-center gap-4 py-6 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>k(t=>Math.max(1,t-1)),disabled:I===1,className:"px-4 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"이전"}),e.jsxs("span",{className:"text-sm text-gray-600 font-bold",children:[I," / ",T," 페이지"]}),e.jsx("button",{onClick:()=>k(t=>Math.min(T,t+1)),disabled:I===T,className:"px-4 py-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"다음"})]})]})]})]})};export{ye as default};
