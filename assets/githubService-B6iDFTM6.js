const e="markjin9981",t="landing-factory",s="main",a="landing_admin_gh_token",n=e=>{localStorage.setItem(a,e)},o=()=>{const e=localStorage.getItem(a);return e||""},r=async a=>{const n=o();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다. 설정 메뉴에서 토큰을 입력해주세요."};try{const o=(await h(a)).split(",")[1],r=Date.now(),i=a.name.replace(/[^a-zA-Z0-9.-]/g,"_"),c=`public/uploads/${r}_${i}`,u=`https://api.github.com/repos/${e}/${t}/contents/${c}`,g=await fetch(u,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`upload: ${i}`,content:o,branch:s})});if(!g.ok){const e=await g.json();throw new Error(e.message||"Github Upload Failed")}return{success:!0,url:`https://raw.githubusercontent.com/${e}/${t}/${s}/${c}`}}catch(r){return{success:!1,message:r.message}}},i=async a=>{const n=o();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const r=`https://api.github.com/repos/${e}/${t}/contents/data/landingConfigs.json`;try{const e=await fetch(r,{headers:{Authorization:`Bearer ${n}`}});let t="";if(e.ok){t=(await e.json()).sha}const o=JSON.stringify(a,null,2),i=btoa(unescape(encodeURIComponent(o))),c=await fetch(r,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`deploy: Update landing configs (${Object.keys(a).length} pages)`,content:i,sha:t||void 0,branch:s})});if(!c.ok){const e=await c.json();throw new Error(e.message)}return{success:!0,message:"설정이 저장되고 배포가 시작되었습니다. (약 1~2분 소요)"}}catch(i){return{success:!1,message:i.message}}},c=async a=>{const n=o();if(!n)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const r=`https://api.github.com/repos/${e}/${t}/contents/data/landingConfigs.json`;try{const e=await fetch(r,{headers:{Authorization:`Bearer ${n}`}});if(!e.ok)throw new Error("Failed to fetch existing configs");const t=await e.json(),o=t.sha,i=decodeURIComponent(escape(window.atob(t.content.replace(/\n/g,"")))),c=JSON.parse(i);if(!c[a])return{success:!0,message:"Already deleted or not found."};delete c[a];const h=JSON.stringify(c,null,2),u=btoa(unescape(encodeURIComponent(h))),g=await fetch(r,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove landing config ${a}`,content:u,sha:o,branch:s})});if(!g.ok){const e=await g.json();throw new Error(e.message)}return{success:!0,message:"GitHub에서도 삭제되었습니다."}}catch(i){return{success:!1,message:i.message}}},h=e=>new Promise((t,s)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)}),u=async()=>{const s=o();if(!s)return[];const a=`https://api.github.com/repos/${e}/${t}/contents/public/uploads`;try{const e=await fetch(a,{headers:{Authorization:`Bearer ${s}`}});if(!e.ok){if(404===e.status)return[];throw new Error("Failed to fetch images")}const t=await e.json();return Array.isArray(t)?t.filter(e=>"file"===e.type&&e.name.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)).map(e=>({name:e.name,path:e.path,sha:e.sha,size:e.size,url:e.html_url,download_url:e.download_url,type:e.type})):[]}catch(n){return[]}},g=async(a,n)=>{const r=o();if(!r)return!1;const i=`https://api.github.com/repos/${e}/${t}/contents/${a}`;try{return(await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove image ${a}`,sha:n,branch:s})})).ok}catch(c){return!1}};export{g as a,i as b,c as d,u as f,o as g,n as s,r as u};
