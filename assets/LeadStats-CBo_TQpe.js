import{c as K,d as R,r as d,j as e,X as V,a as P,L as W,k as X,f as J,l as Q}from"./index-CpBRf0OQ.js";import{C as q,E as Z,D as z}from"./external-link-B43KHooI.js";import{U as ee,L as se}from"./user-CImhs67y.js";import{A}from"./arrow-left-DiermuT6.js";import{R as te}from"./refresh-cw-BZpdq0Vk.js";import{C as ae}from"./calendar-Bfqcu9EG.js";import{T as B}from"./trash-2-Df0xRHNS.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=K("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),le=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],F=n=>{if(!n||typeof n!="string")return 0;const m=new Date(n).getTime();if(!isNaN(m))return m;try{const t=n.match(/\d+/g);if(!t||t.length<3)return 0;let h=parseInt(t[0],10),j=parseInt(t[1],10)-1,p=parseInt(t[2],10),i=0,l=0;return t.length>=4&&(i=parseInt(t[3],10)),t.length>=5&&(l=parseInt(t[4],10)),(n.includes("오후")||n.toLowerCase().includes("pm"))&&i<12&&(i+=12),new Date(h,j,p,i,l).getTime()}catch{return 0}},oe=({isOpen:n,onClose:m,title:t,leads:h,landingTitles:j})=>{const p=R(),i=d.useMemo(()=>[...h].sort((l,w)=>F(w.Timestamp)-F(l.Timestamp)),[h]);return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["총 ",h.length,"건의 데이터가 조회되었습니다."]})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 p-6 space-y-4 bg-gray-50",children:i.length===0?e.jsx("div",{className:"bg-white rounded-xl p-10 text-center border border-gray-100 shadow-sm",children:e.jsx("p",{className:"text-gray-400",children:"수집된 데이터가 없습니다."})}):i.map((l,w)=>{const k=String(l["Landing ID"]||""),S=j[k]||`ID: ${k}`,C=l.Name||l.name||l.이름,v=l.Phone||l.phone||l.연락처||l.휴대폰,u=[];Object.entries(l).forEach(([f,N])=>{const L=f.toLowerCase();le.includes(L)||["name","phone","이름","연락처","휴대폰","landing id"].includes(L)||N&&u.push(`${f}: ${N}`)});const D=l.Timestamp||"";return e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]",children:S}),e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),D]})]}),e.jsx("button",{onClick:()=>{m(),p(`/admin/stats/${k}`)},className:"text-gray-400 hover:text-blue-600 transition-colors",title:"해당 페이지 통계로 이동",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-900 text-lg",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-400"}),C]}),v&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium font-mono",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),v]}),!C&&!v&&e.jsx("span",{className:"text-gray-500 italic",children:"식별 정보 없음"})]}),u.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg mt-1",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400 mt-0.5 shrink-0"}),e.jsx("p",{className:"line-clamp-2 leading-relaxed",children:u.join("  |  ")})]})]})]},w)})})]})}):null},ie=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],_=n=>{if(!n||typeof n!="string")return 0;const m=new Date(n).getTime();if(!isNaN(m))return m;try{const t=n.match(/\d+/g);if(!t||t.length<3)return 0;let h=parseInt(t[0],10),j=parseInt(t[1],10)-1,p=parseInt(t[2],10),i=0,l=0;return t.length>=4&&(i=parseInt(t[3],10)),t.length>=5&&(l=parseInt(t[4],10)),(n.includes("오후")||n.toLowerCase().includes("pm"))&&i<12&&(i+=12),new Date(h,j,p,i,l).getTime()}catch{return 0}},ue=()=>{const[n,m]=d.useState([]),[t,h]=d.useState([]),[j,p]=d.useState(!0),i=R(),[l,w]=d.useState(!1),[k,S]=d.useState(""),[C,v]=d.useState([]),[u,D]=d.useState(null),[f,N]=d.useState(0),[L,E]=d.useState(!1),I=async()=>{p(!0);try{const[s,a]=await Promise.all([X(),J()]);m(s),h(a)}catch(s){console.error(s)}finally{p(!1)}};d.useEffect(()=>{I()},[]);const O=d.useMemo(()=>{const s={};return n.forEach(a=>{const o=String(a["Landing ID"]||"unknown");s[o]||(s[o]=[]),s[o].push(a)}),Object.keys(s).forEach(a=>{s[a].sort((o,x)=>_(x.Timestamp)-_(o.Timestamp))}),s},[n]),T=d.useMemo(()=>{const s=new Date().getTime(),a=new Date;a.setHours(0,0,0,0);const o=a.getTime(),x=s-60*60*1e3,c=[],g=[];return n.forEach(b=>{const r=_(b.Timestamp);r>=o&&c.push(b),r>=x&&g.push(b)}),{todayCount:c.length,todayLeads:c,hourCount:g.length,hourLeads:g,totalCount:n.length}},[n]),H=d.useMemo(()=>{const s={};return t.forEach(a=>s[String(a.id)]=a.title),s},[t]),$=s=>{s==="today"?(S("오늘 수집된 DB"),v(T.todayLeads)):(S("최근 1시간 내 수집된 DB"),v(T.hourLeads)),w(!0)},U=s=>{D(s),N(1)},Y=async()=>{if(!u)return;if(f===1){N(2);return}E(!0),await Q(u)?(h(a=>a.filter(o=>String(o.id)!==u)),N(0),D(null)):alert("삭제 실패"),E(!1)},G=(s,a)=>{var b;const o=t.find(r=>String(r.id)===s),x=[{key:"Timestamp",label:"시간"}],c=new Set(["Timestamp","Landing ID"]);if((b=o==null?void 0:o.formConfig)!=null&&b.fields)o.formConfig.fields.forEach(r=>{x.push({key:r.id,label:r.label}),c.add(r.id),c.add(r.id.toLowerCase())});else if(a.length>0){const r=a[0];r.Name&&(x.push({key:"Name",label:"이름"}),c.add("Name")),r.Phone&&(x.push({key:"Phone",label:"연락처"}),c.add("Phone"))}const g=new Set;return a.forEach(r=>{Object.keys(r).forEach(y=>{c.has(y)||c.has(y.toLowerCase())||ie.includes(y.toLowerCase())||y.startsWith("consent_")||g.add(y)})}),g.has("Memo")&&(g.delete("Memo"),x.push({key:"Memo",label:"메모"})),{columns:x,extraKeys:Array.from(g)}};return j?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(P,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(A,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-bold",children:"DB 수집 현황"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:I,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(te,{className:"w-4 h-4 mr-2"})," 새로고침"]}),e.jsxs("button",{onClick:()=>{sessionStorage.removeItem("admin_auth"),i("/admin/login")},className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-bold",children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," 로그아웃"]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{onClick:()=>$("today"),className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5 cursor-pointer hover:border-blue-400 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"p-4 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(ae,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1 group-hover:text-blue-600",children:"오늘 수집된 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[T.todayCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{onClick:()=>$("hour"),className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5 cursor-pointer hover:border-emerald-400 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors",children:e.jsx(q,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1 group-hover:text-emerald-600",children:"최근 1시간 내 수집"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[T.hourCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(z,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"누적 수집 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[T.totalCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]})]}),Object.keys(O).length===0?e.jsx("div",{className:"text-center py-20 bg-white rounded-xl border-dashed border-2 border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"수집된 데이터가 없습니다."})}):Object.entries(O).map(([s,a])=>{const o=t.find(r=>String(r.id)===s),x=o?o.title:`알 수 없는 페이지 (ID: ${s})`,{columns:c}=G(s,a),g=a.slice(0,5),b=!o;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white p-2 border border-gray-200 rounded-lg",children:e.jsx(z,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:x}),e.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:["ID: ",s]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold mr-2",children:["총 ",a.length," 건"]}),e.jsxs("button",{onClick:()=>i(`/admin/stats/${s}`),className:"flex items-center gap-1 text-sm font-bold text-gray-600 hover:text-blue-600 bg-white border border-gray-300 hover:border-blue-400 px-3 py-1.5 rounded-lg transition-all",children:["상세보기 ",e.jsx(A,{className:"w-4 h-4 rotate-180"})]}),!b&&e.jsx("button",{onClick:()=>U(s),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-transparent hover:border-red-200",title:"페이지 삭제",children:e.jsx(B,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),c.slice(0,5).map(r=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:r.label},r.key)),c.length>5&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-400",children:"..."})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[g.map((r,y)=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:a.length-y}),c.slice(0,5).map(M=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:r[M.key]||r[M.key.toLowerCase()]||"-"},M.key)),c.length>5&&e.jsx("td",{className:"px-6 py-4 text-gray-300",children:"..."})]},y)),a.length>5&&e.jsx("tr",{children:e.jsx("td",{colSpan:c.slice(0,5).length+2,className:"px-6 py-3 text-center bg-gray-50/30",children:e.jsxs("button",{onClick:()=>i(`/admin/stats/${s}`),className:"text-xs font-bold text-blue-600 hover:underline",children:["+ ",a.length-5,"개 더보기"]})})})]})]})})]},s)})]}),e.jsx(oe,{isOpen:l,onClose:()=>w(!1),title:k,leads:C,landingTitles:H}),u&&f>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:f===1?"페이지 설정을 삭제하시겠습니까?":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep text-sm",children:f===1?e.jsxs(e.Fragment,{children:["랜딩페이지 설정이 목록에서 사라집니다.",e.jsx("br",{}),"(이미 수집된 DB는 보존되지만 '알 수 없는 페이지'로 분류됩니다.)"]}):e.jsxs(e.Fragment,{children:["삭제된 설정은 ",e.jsx("strong",{className:"text-red-500",children:"복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{N(0),D(null)},className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:Y,disabled:L,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:L?e.jsx(P,{className:"w-5 h-5 animate-spin"}):f===1?"계속하기":"삭제 확정"})]})]})})]})};export{ue as default};
