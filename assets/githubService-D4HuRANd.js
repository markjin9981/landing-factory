const l="markjin9981",g="landing-factory",d="main",f="landing_admin_gh_token",y=e=>{localStorage.setItem(f,e)},p=()=>{const e=localStorage.getItem(f);return e||""},$=async e=>{const s=p();if(!s)return{success:!1,message:"GitHub Token이 설정되지 않았습니다. 설정 메뉴에서 토큰을 입력해주세요."};try{const o=(await w(e)).split(",")[1],t=Date.now(),a=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),c=`public/uploads/${t}_${a}`,i=`https://api.github.com/repos/${l}/${g}/contents/${c}`,n=await fetch(i,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({message:`upload: ${a}`,content:o,branch:d})});if(!n.ok){const h=await n.json();throw new Error(h.message||"Github Upload Failed")}return{success:!0,url:`https://raw.githubusercontent.com/${l}/${g}/${d}/${c}`}}catch(r){return console.error("GitHub Upload Error:",r),{success:!1,message:r.message}}},T=async e=>{const s=p();if(!s)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const o=`https://api.github.com/repos/${l}/${g}/contents/data/landingConfigs.json`;try{const t=await fetch(o,{headers:{Authorization:`Bearer ${s}`}});let a="";t.ok&&(a=(await t.json()).sha);const c=JSON.stringify(e,null,2),i=btoa(unescape(encodeURIComponent(c))),n=await fetch(o,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({message:`deploy: Update landing configs (${Object.keys(e).length} pages)`,content:i,sha:a||void 0,branch:d})});if(!n.ok){const u=await n.json();throw new Error(u.message)}return{success:!0,message:"설정이 저장되고 배포가 시작되었습니다. (약 1~2분 소요)"}}catch(t){return console.error("GitHub Deploy Error:",t),{success:!1,message:t.message}}},U=async e=>{const s=p();if(!s)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const o=`https://api.github.com/repos/${l}/${g}/contents/data/landingConfigs.json`;try{const t=await fetch(o,{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Failed to fetch existing configs");const a=await t.json(),c=a.sha,i=decodeURIComponent(escape(window.atob(a.content.replace(/\n/g,"")))),n=JSON.parse(i);if(!n[e])return{success:!0,message:"Already deleted or not found."};delete n[e];const u=JSON.stringify(n,null,2),h=btoa(unescape(encodeURIComponent(u))),m=await fetch(o,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove landing config ${e}`,content:h,sha:c,branch:d})});if(!m.ok){const b=await m.json();throw new Error(b.message)}return{success:!0,message:"GitHub에서도 삭제되었습니다."}}catch(t){return console.error("GitHub Delete Error:",t),{success:!1,message:t.message}}},w=e=>new Promise((s,r)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>s(o.result),o.onerror=t=>r(t)});export{T as a,U as d,p as g,y as s,$ as u};
