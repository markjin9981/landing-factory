import{r as h,d as k,j as e,a as D,L,k as E,f as T}from"./index-B-ziXinY.js";import{A as w}from"./arrow-left-Bcq4bgc0.js";import{R as _}from"./refresh-cw-DHyUBs0M.js";import{L as S}from"./log-out-BsdVf9qN.js";import{C as M}from"./calendar-CaBdych0.js";import{D as v}from"./database-D1Y1GQvf.js";const I=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],u=o=>{if(!o||typeof o!="string")return 0;const p=new Date(o).getTime();if(!isNaN(p))return p;try{const l=o.match(/\d+/g);if(!l||l.length<3)return 0;let b=parseInt(l[0],10),y=parseInt(l[1],10)-1,f=parseInt(l[2],10),m=0,g=0;return l.length>=4&&(m=parseInt(l[3],10)),l.length>=5&&(g=parseInt(l[4],10)),(o.includes("오후")||o.toLowerCase().includes("pm"))&&m<12&&(m+=12),new Date(b,y,f,m,g).getTime()}catch{return 0}},$=()=>{const[o,p]=h.useState([]),[l,b]=h.useState([]),[y,f]=h.useState(!0),m=k(),g=async()=>{f(!0);try{const[s,t]=await Promise.all([E(),T()]);p(s),b(t)}catch(s){console.error(s)}finally{f(!1)}};h.useEffect(()=>{g()},[]);const j=h.useMemo(()=>{const s={};return o.forEach(t=>{const a=String(t["Landing ID"]||"unknown");s[a]||(s[a]=[]),s[a].push(t)}),Object.keys(s).forEach(t=>{s[t].sort((a,i)=>u(i.Timestamp)-u(a.Timestamp))}),s},[o]),N=h.useMemo(()=>{const s=new Date;s.setHours(0,0,0,0);const t=s.getTime();let a=0,i=o.length;return o.forEach(r=>{u(r.Timestamp)>=t&&a++}),{todayCount:a,totalCount:i}},[o]),C=(s,t)=>{var c;const a=l.find(n=>String(n.id)===s),i=[{key:"Timestamp",label:"시간"}],r=new Set(["Timestamp","Landing ID"]);if((c=a==null?void 0:a.formConfig)!=null&&c.fields)a.formConfig.fields.forEach(n=>{i.push({key:n.id,label:n.label}),r.add(n.id),r.add(n.id.toLowerCase())});else if(t.length>0){const n=t[0];n.Name&&(i.push({key:"Name",label:"이름"}),r.add("Name")),n.Phone&&(i.push({key:"Phone",label:"연락처"}),r.add("Phone"))}const x=new Set;return t.forEach(n=>{Object.keys(n).forEach(d=>{r.has(d)||r.has(d.toLowerCase())||I.includes(d.toLowerCase())||d.startsWith("consent_")||x.add(d)})}),x.has("Memo")&&(x.delete("Memo"),i.push({key:"Memo",label:"메모"})),{columns:i,extraKeys:Array.from(x)}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(D,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(w,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-bold",children:"DB 수집 현황"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:g,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(_,{className:"w-4 h-4 mr-2"})," 새로고침"]}),e.jsxs("button",{onClick:()=>{sessionStorage.removeItem("admin_auth"),m("/admin/login")},className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-bold",children:[e.jsx(S,{className:"w-4 h-4 mr-2"})," 로그아웃"]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(M,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"오늘 수집된 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[N.todayCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(v,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"누적 수집 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[N.totalCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]})]}),Object.keys(j).length===0?e.jsx("div",{className:"text-center py-20 bg-white rounded-xl border-dashed border-2 border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"수집된 데이터가 없습니다."})}):Object.entries(j).map(([s,t])=>{const a=l.find(c=>String(c.id)===s),i=a?a.title:`알 수 없는 페이지 (ID: ${s})`,{columns:r}=C(s,t),x=t.slice(0,5);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white p-2 border border-gray-200 rounded-lg",children:e.jsx(v,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:i}),e.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:["ID: ",s]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold",children:["총 ",t.length," 건"]}),e.jsxs("button",{onClick:()=>m(`/admin/stats/${s}`),className:"flex items-center gap-1 text-sm font-bold text-gray-600 hover:text-blue-600 bg-white border border-gray-300 hover:border-blue-400 px-3 py-1.5 rounded-lg transition-all",children:["상세보기 ",e.jsx(w,{className:"w-4 h-4 rotate-180"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),r.slice(0,5).map(c=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:c.label},c.key)),r.length>5&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-400",children:"..."})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[x.map((c,n)=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:t.length-n}),r.slice(0,5).map(d=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:c[d.key]||c[d.key.toLowerCase()]||"-"},d.key)),r.length>5&&e.jsx("td",{className:"px-6 py-4 text-gray-300",children:"..."})]},n)),t.length>5&&e.jsx("tr",{children:e.jsx("td",{colSpan:r.slice(0,5).length+2,className:"px-6 py-3 text-center bg-gray-50/30",children:e.jsxs("button",{onClick:()=>m(`/admin/stats/${s}`),className:"text-xs font-bold text-blue-600 hover:underline",children:["+ ",t.length-5,"개 더보기"]})})})]})]})})]},s)})]})]})};export{$ as default};
