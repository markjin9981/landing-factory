import{j as e}from"./animation-BOIIKJnC.js";import{r as i,L as V}from"./vendor-B_BVtOF2.js";import{X as q,B as z,f as K}from"./index-DXltStGZ.js";import{A as X}from"./arrow-left-CrxIhJt2.js";import{R as _}from"./refresh-cw-B-YTc0fY.js";import{F as G}from"./filter-CFriCsK0.js";import{C as H}from"./calendar-D1fdQaFp.js";import{S as J}from"./smartphone-jtvwVrgw.js";import{M as Q}from"./monitor-BnIJ9A8E.js";const le=()=>{const[g,$]=i.useState([]),[y,k]=i.useState([]),[N,w]=i.useState(!0),[h,T]=i.useState("all"),[p,F]=i.useState("desc"),[u,R]=i.useState("timestamp"),[c,v]=i.useState(null),[D,S]=i.useState(!1),[o,C]=i.useState(new Date),I=async()=>{w(!0);const[t,s]=await Promise.all([z(),K()]);$(t),k(s),w(!1)};i.useEffect(()=>{I()},[]);const b=t=>{if(!t||typeof t!="string")return 0;const s=new Date(t).getTime();if(!isNaN(s))return s;try{const r=t.includes("오후")||t.toLowerCase().includes("pm"),n=t.includes("오전")||t.toLowerCase().includes("am"),a=t.match(/\d+/g);if(!a||a.length<3)return 0;let l=parseInt(a[0],10),d=parseInt(a[1],10)-1,x=parseInt(a[2],10),m=0,M=0,L=0;return a.length>=4&&(m=parseInt(a[3],10)),a.length>=5&&(M=parseInt(a[4],10)),a.length>=6&&(L=parseInt(a[5],10)),r&&m<12&&(m+=12),n&&m===12&&(m=0),new Date(l,d,x,m,M,L).getTime()}catch{return 0}},f=t=>{const s=y.find(r=>String(r.id)===String(t));return s?s.title:`(ID: ${t})`},A=i.useMemo(()=>{const s=Array.from(new Set(g.map(r=>r["Landing ID"]))).map(r=>({id:String(r),title:f(String(r))}));return s.sort((r,n)=>r.title.localeCompare(n.title)),s},[g,y]),j=i.useMemo(()=>{let t=[...g];return h!=="all"&&(t=t.filter(s=>String(s["Landing ID"])===h)),c&&(t=t.filter(s=>{const r=s.Timestamp,n=b(r);if(!n)return!1;const a=new Date(n),l=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),x=String(a.getDate()).padStart(2,"0");return`${l}-${d}-${x}`===c})),t.sort((s,r)=>{if(u==="timestamp"){const n=b(s.Timestamp),a=b(r.Timestamp);return p==="desc"?a-n:n-a}else if(u==="title"){const n=f(String(s["Landing ID"]))||"",a=f(String(r["Landing ID"]))||"";return p==="asc"?n.localeCompare(a):a.localeCompare(n)}return 0}),t},[g,y,h,c,p,u]),B=(t,s)=>new Date(t,s+1,0).getDate(),O=(t,s)=>new Date(t,s,1).getDay(),P=()=>{const t=o.getFullYear(),s=o.getMonth(),r=B(t,s),n=O(t,s),a=[];for(let l=0;l<n;l++)a.push(e.jsx("div",{className:"h-8 w-8"},`empty-${l}`));for(let l=1;l<=r;l++){const d=`${t}-${String(s+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`,x=c===d;a.push(e.jsx("button",{onClick:()=>{v(x?null:d),S(!1)},className:`h-8 w-8 rounded-full text-xs font-bold flex items-center justify-center relative
                    ${x?"bg-blue-600 text-white":"hover:bg-gray-100 text-gray-700"}
                `,children:l},l))}return a},Y=()=>C(new Date(o.getFullYear(),o.getMonth()-1,1)),E=()=>C(new Date(o.getFullYear(),o.getMonth()+1,1));return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(X,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-xl font-bold",children:"유입 경로 상세 (로그)"})]}),e.jsxs("button",{onClick:I,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(_,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),"새로고침"]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6 flex flex-wrap items-center gap-4 shadow-sm relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"필터:"})]}),e.jsxs("select",{value:h,onChange:t=>T(t.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none max-w-xs",children:[e.jsx("option",{value:"all",children:"전체 랜딩페이지"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",t.id,")"]},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>S(!D),className:`flex items-center gap-2 px-3 py-2 border rounded-lg text-sm ${c?"bg-blue-50 border-blue-200 text-blue-700 font-bold":"border-gray-300 text-gray-700"}`,children:[e.jsx(H,{className:"w-4 h-4"}),c||"날짜 선택",c&&e.jsx(q,{className:"w-3 h-3 hover:text-red-500",onClick:t=>{t.stopPropagation(),v(null)}})]}),D&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-xl p-4 z-50 w-64 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:Y,className:"p-1 hover:bg-gray-100 rounded",children:"<"}),e.jsxs("span",{className:"text-sm font-bold",children:[o.getFullYear(),"년 ",o.getMonth()+1,"월"]}),e.jsx("button",{onClick:E,className:"p-1 hover:bg-gray-100 rounded",children:">"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["일","월","화","수","목","금","토"].map(t=>e.jsx("div",{className:"text-xs text-gray-400 font-bold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:P()})]})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2 hidden md:block"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"정렬:"}),e.jsxs("select",{value:u,onChange:t=>R(t.target.value),className:"border border-gray-300 rounded-lg px-2 py-1 text-sm outline-none",children:[e.jsx("option",{value:"timestamp",children:"시간순"}),e.jsx("option",{value:"title",children:"페이지 제목순"})]}),e.jsx("button",{onClick:()=>F(t=>t==="desc"?"asc":"desc"),className:"px-3 py-1 rounded text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold",children:p==="desc"?"내림차순 (▼)":"오름차순 (▲)"})]}),e.jsxs("div",{className:"ml-auto text-sm text-gray-500",children:["총 ",e.jsx("strong",{children:j.length}),"건 조회됨"]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"날짜"}),e.jsx("th",{className:"px-6 py-3",children:"페이지 (Title)"}),e.jsx("th",{className:"px-6 py-3",children:"기기"}),e.jsx("th",{className:"px-6 py-3",children:"OS/브라우저"}),e.jsx("th",{className:"px-6 py-3",children:"IP"}),e.jsx("th",{className:"px-6 py-3",children:"유입경로"}),e.jsx("th",{className:"px-6 py-3",children:"랜딩ID"})]})}),e.jsxs("tbody",{children:[j.map((t,s)=>{const r=f(String(t["Landing ID"]));return e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.Timestamp}),e.jsx("td",{className:"px-6 py-4 font-bold text-blue-600",children:r}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.Device==="Mobile"?e.jsx(J,{className:"w-4 h-4 text-orange-500"}):e.jsx(Q,{className:"w-4 h-4 text-blue-500"}),t.Device]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:"mr-2 text-gray-800 font-medium",children:t.OS}),e.jsx("span",{className:"text-gray-400",children:t.Browser})]}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:t.IP}),e.jsx("td",{className:"px-6 py-4 max-w-xs truncate",title:t.Referrer,children:t.Referrer==="Direct"?e.jsx("span",{className:"text-gray-400",children:"직접 접속/없음"}):e.jsx("a",{href:t.Referrer,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:t.Referrer})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-bold",children:t["Landing ID"]})})]},s)}),!N&&j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-gray-400",children:g.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})})]})]})})})]})]})};export{le as default};
