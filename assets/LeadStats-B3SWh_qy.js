import{c as W,k as U,r as h,j as e,X,C as H,P as J,a as F,L as Q,D as R,b as Z,f as ee,B as se,_ as te}from"./index-CUWFItgx.js";import{E as ae}from"./external-link-DDzRlPCW.js";import{U as re,L as ne}from"./user-CLnKXcIF.js";import{A as z}from"./arrow-left-G1nbSXl-.js";import{R as le}from"./refresh-cw-BofcwAhd.js";import{C as ie}from"./calendar-CRuenfGV.js";import{T as A}from"./trash-2-Dvoh-9jC.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=W("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),de=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],K=n=>{if(!n||typeof n!="string")return 0;const g=new Date(n).getTime();if(!isNaN(g))return g;try{const a=n.match(/\d+/g);if(!a||a.length<3)return 0;let p=parseInt(a[0],10),w=parseInt(a[1],10)-1,y=parseInt(a[2],10),d=0,o=0;return a.length>=4&&(d=parseInt(a[3],10)),a.length>=5&&(o=parseInt(a[4],10)),(n.includes("오후")||n.toLowerCase().includes("pm"))&&d<12&&(d+=12),new Date(p,w,y,d,o).getTime()}catch{return 0}},ce=({isOpen:n,onClose:g,title:a,leads:p,landingTitles:w})=>{const y=U(),d=h.useMemo(()=>[...p].sort((o,k)=>K(k.Timestamp)-K(o.Timestamp)),[p]);return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[85vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:a}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["총 ",p.length,"건의 데이터가 조회되었습니다."]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(X,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 p-6 space-y-4 bg-gray-50",children:d.length===0?e.jsx("div",{className:"bg-white rounded-xl p-10 text-center border border-gray-100 shadow-sm",children:e.jsx("p",{className:"text-gray-400",children:"수집된 데이터가 없습니다."})}):d.map((o,k)=>{const D=String(o["Landing ID"]||""),S=w[D]||`ID: ${D}`,L=o.Name||o.name||o.이름,C=o.Phone||o.phone||o.연락처||o.휴대폰,m=[];Object.entries(o).forEach(([j,f])=>{const T=j.toLowerCase();de.includes(T)||["name","phone","이름","연락처","휴대폰","landing id"].includes(T)||f&&m.push(`${j}: ${f}`)});const v=o.Timestamp||"";return e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]",children:S}),e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),v]})]}),e.jsx("button",{onClick:()=>{g(),y(`/admin/stats/${D}`)},className:"text-gray-400 hover:text-blue-600 transition-colors",title:"해당 페이지 통계로 이동",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[L&&e.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-900 text-lg",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),L]}),C&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 font-medium font-mono",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),C]}),!L&&!C&&e.jsx("span",{className:"text-gray-500 italic",children:"식별 정보 없음"})]}),m.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg mt-1",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400 mt-0.5 shrink-0"}),e.jsx("p",{className:"line-clamp-2 leading-relaxed",children:m.join("  |  ")})]})]})]},k)})})]})}):null},xe=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],M=n=>{if(!n||typeof n!="string")return 0;const g=new Date(n).getTime();if(!isNaN(g))return g;try{const a=n.match(/\d+/g);if(!a||a.length<3)return 0;let p=parseInt(a[0],10),w=parseInt(a[1],10)-1,y=parseInt(a[2],10),d=0,o=0;return a.length>=4&&(d=parseInt(a[3],10)),a.length>=5&&(o=parseInt(a[4],10)),(n.includes("오후")||n.toLowerCase().includes("pm"))&&d<12&&(d+=12),new Date(p,w,y,d,o).getTime()}catch{return 0}},ye=()=>{var B;const[n,g]=h.useState([]),[a,p]=h.useState([]),[w,y]=h.useState(!0),d=U(),[o,k]=h.useState(!1),[D,S]=h.useState(""),[L,C]=h.useState([]),[m,v]=h.useState(null),[j,f]=h.useState(0),[T,I]=h.useState(!1),$=async()=>{y(!0);try{const[s,t]=await Promise.all([Z(),ee()]);g(s),p(t)}catch(s){console.error(s)}finally{y(!1)}};h.useEffect(()=>{$()},[]);const E=h.useMemo(()=>{const s={};return n.forEach(t=>{const l=String(t["Landing ID"]||"unknown");s[l]||(s[l]=[]),s[l].push(t)}),Object.keys(s).forEach(t=>{s[t].sort((l,c)=>M(c.Timestamp)-M(l.Timestamp))}),s},[n]),_=h.useMemo(()=>{const s=new Date().getTime(),t=new Date;t.setHours(0,0,0,0);const l=t.getTime(),c=s-60*60*1e3,i=[],x=[];return n.forEach(N=>{const r=M(N.Timestamp);r>=l&&i.push(N),r>=c&&x.push(N)}),{todayCount:i.length,todayLeads:i,hourCount:x.length,hourLeads:x,totalCount:n.length}},[n]),q=h.useMemo(()=>{const s={};return a.forEach(t=>s[String(t.id)]=t.title),s},[a]),O=s=>{s==="today"?(S("오늘 수집된 DB"),C(_.todayLeads)):(S("최근 1시간 내 수집된 DB"),C(_.hourLeads)),k(!0)},V=s=>{v(s),f(1)},Y=async()=>{if(!m)return;if(j===1){f(2);return}if(I(!0),a.find(t=>String(t.id)===m))await se(m)?(p(l=>l.filter(c=>String(c.id)!==m)),f(0),v(null)):alert("설정 삭제 실패");else{const{deleteLeads:t}=await te(async()=>{const{deleteLeads:i}=await import("./index-CUWFItgx.js").then(x=>x.a6);return{deleteLeads:i}},[]),l=E[m]||[];if(l.length===0){f(0),v(null),I(!1);return}const c=await t(l);c.result==="success"?(g(i=>i.filter(x=>String(x["Landing ID"]||"unknown")!==m)),f(0),v(null)):alert("데이터 삭제 실패: "+c.message)}I(!1)},G=(s,t)=>{var N;const l=a.find(r=>String(r.id)===s),c=[{key:"Timestamp",label:"시간"}],i=new Set(["Timestamp","Landing ID"]);if((N=l==null?void 0:l.formConfig)!=null&&N.fields)l.formConfig.fields.forEach(r=>{c.push({key:r.id,label:r.label}),i.add(r.id),i.add(r.id.toLowerCase())});else if(t.length>0){const r=t[0];r.Name&&(c.push({key:"Name",label:"이름"}),i.add("Name")),r.Phone&&(c.push({key:"Phone",label:"연락처"}),i.add("Phone"))}const x=new Set;return t.forEach(r=>{Object.keys(r).forEach(u=>{i.has(u)||i.has(u.toLowerCase())||xe.includes(u.toLowerCase())||u.startsWith("consent_")||x.add(u)})}),x.has("Memo")&&(x.delete("Memo"),c.push({key:"Memo",label:"메모"})),{columns:c,extraKeys:Array.from(x)}};if(w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(F,{className:"w-8 h-8 text-blue-600 animate-spin"})});const P=m&&!a.find(s=>String(s.id)===m);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-8 md:py-5 flex flex-col md:flex-row items-center justify-between sticky top-0 z-10 shadow-sm gap-4 md:gap-0",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx(Q,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(z,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-lg md:text-xl font-bold",children:"DB 수집 현황"})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[e.jsxs("button",{onClick:$,className:"flex-1 md:flex-none justify-center items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," 새로고침"]}),e.jsxs("button",{onClick:()=>{sessionStorage.removeItem("admin_auth"),d("/admin/login")},className:"flex-1 md:flex-none justify-center items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-bold",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," 로그아웃"]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{onClick:()=>O("today"),className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5 cursor-pointer hover:border-blue-400 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"p-4 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(ie,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1 group-hover:text-blue-600",children:"오늘 수집된 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[_.todayCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{onClick:()=>O("hour"),className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5 cursor-pointer hover:border-emerald-400 hover:shadow-md transition-all group",children:[e.jsx("div",{className:"p-4 bg-emerald-50 text-emerald-600 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors",children:e.jsx(H,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1 group-hover:text-emerald-600",children:"최근 1시간 내 수집"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[_.hourCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(R,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold mb-1",children:"누적 수집 DB"}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900",children:[_.totalCount," ",e.jsx("span",{className:"text-lg text-gray-400 font-normal",children:"건"})]})]})]})]}),Object.keys(E).length===0?e.jsx("div",{className:"text-center py-20 bg-white rounded-xl border-dashed border-2 border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"수집된 데이터가 없습니다."})}):Object.entries(E).map(([s,t])=>{const l=a.find(r=>String(r.id)===s),c=l?l.title:`알 수 없는 페이지 (ID: ${s})`,{columns:i}=G(s,t),x=t.slice(0,5),N=!l;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"px-4 py-3 md:px-6 md:py-4 bg-gray-50 border-b border-gray-200 flex flex-col md:flex-row md:justify-between md:items-center gap-3 md:gap-0",children:[e.jsxs("div",{className:"flex items-start justify-between w-full md:w-auto md:justify-start gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"bg-white p-2 border border-gray-200 rounded-lg shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-base md:text-lg truncate pr-2",children:c}),e.jsxs("p",{className:"text-xs text-gray-400 font-mono truncate",children:["ID: ",s]})]})]}),e.jsx("div",{className:"md:hidden shrink-0",children:e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-[10px] font-bold",children:["총 ",t.length,"건"]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 w-full md:w-auto",children:[e.jsxs("span",{className:"hidden md:inline-block bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold mr-2",children:["총 ",t.length," 건"]}),e.jsxs("button",{onClick:()=>d(`/admin/stats/${s}`),className:"flex-1 md:flex-none justify-center items-center gap-1 text-xs md:text-sm font-bold text-gray-600 hover:text-blue-600 bg-white border border-gray-300 hover:border-blue-400 px-3 py-1.5 rounded-lg transition-all flex",children:["상세보기 ",e.jsx(z,{className:"w-3 h-3 md:w-4 md:h-4 rotate-180"})]}),e.jsx("button",{onClick:()=>V(s),className:"p-1.5 md:p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-transparent hover:border-red-200",title:N?"모든 데이터 삭제":"페이지 삭제",children:e.jsx(A,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),i.slice(0,5).map(r=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:r.label},r.key)),i.length>5&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-400",children:"..."})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[x.map((r,u)=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs",children:t.length-u}),i.slice(0,5).map(b=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:r[b.key]||r[b.key.toLowerCase()]||"-"},b.key)),i.length>5&&e.jsx("td",{className:"px-6 py-4 text-gray-300",children:"..."})]},u)),t.length>5&&e.jsx("tr",{children:e.jsx("td",{colSpan:i.slice(0,5).length+2,className:"px-6 py-3 text-center bg-gray-50/30",children:e.jsxs("button",{onClick:()=>d(`/admin/stats/${s}`),className:"text-xs font-bold text-blue-600 hover:underline",children:["+ ",t.length-5,"개 더보기"]})})})]})]})}),e.jsx("div",{className:"md:hidden",children:e.jsxs("div",{className:"divide-y divide-gray-100",children:[x.map((r,u)=>e.jsxs("div",{className:"p-4 bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",t.length-u]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:r.Timestamp?r.Timestamp.split(" ")[1]:"-"})]}),e.jsx("div",{className:"space-y-1",children:i.slice(1,4).map(b=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500 w-16 truncate",children:b.label}),e.jsx("span",{className:`text-sm font-medium ${b.key==="Phone"?"text-blue-600":"text-gray-900"} text-right truncate flex-1`,children:r[b.key]||r[b.key.toLowerCase()]||"-"})]},b.key))})]},u)),t.length>5&&e.jsx("div",{className:"p-3 text-center bg-gray-50 border-t border-gray-100",children:e.jsxs("button",{onClick:()=>d(`/admin/stats/${s}`),className:"w-full py-2 text-sm font-bold text-blue-600 border border-blue-200 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors",children:["전체보기 (+",t.length-5,")"]})})]})})]},s)})]}),e.jsx(ce,{isOpen:o,onClose:()=>k(!1),title:D,leads:L,landingTitles:q}),m&&j>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(A,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:j===1?P?"해당 목록을 비우시겠습니까?":"페이지 설정을 삭제하시겠습니까?":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep text-sm",children:j===1?P?e.jsxs(e.Fragment,{children:["해당 그룹의 ",e.jsxs("strong",{className:"text-red-500",children:["모든 DB(",(B=E[m])==null?void 0:B.length,"건)"]}),"가 삭제됩니다.",e.jsx("br",{}),"이 작업은 설정 파일과 무관하게 데이터만 삭제합니다."]}):e.jsxs(e.Fragment,{children:["랜딩페이지 설정이 목록에서 사라집니다.",e.jsx("br",{}),"(이미 수집된 DB는 보존되지만 '알 수 없는 페이지'로 분류됩니다.)"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{className:"text-red-500",children:"복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{f(0),v(null)},className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:Y,disabled:T,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:T?e.jsx(F,{className:"w-5 h-5 animate-spin"}):j===1?"계속하기":"삭제 확정"})]})]})})]})};export{ye as default};
