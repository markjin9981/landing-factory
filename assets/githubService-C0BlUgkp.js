import{c as e}from"./index-CHeZAabq.js";
/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t=e("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),s="markjin9981",a="landing-factory",n="main",o="landing_admin_gh_token",r=e=>{localStorage.setItem(o,e)},c=()=>{const e=localStorage.getItem(o);return e||""},i=async e=>{const t=c();if(!t)return{success:!1,message:"GitHub Token이 설정되지 않았습니다. 설정 메뉴에서 토큰을 입력해주세요."};try{const o=(await p(e)).split(",")[1],r=Date.now(),c=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),i=`public/uploads/${r}_${c}`,u=`https://api.github.com/repos/${s}/${a}/contents/${i}`,h=await fetch(u,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({message:`upload: ${c}`,content:o,branch:n})});if(!h.ok){const e=await h.json();throw new Error(e.message||"Github Upload Failed")}return{success:!0,url:`https://raw.githubusercontent.com/${s}/${a}/${n}/${i}`}}catch(o){return{success:!1,message:o.message}}},u=async e=>{const t=c();if(!t)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const o=`https://api.github.com/repos/${s}/${a}/contents/data/landingConfigs.json`;try{const s=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});let a="";if(s.ok){a=(await s.json()).sha}const r=JSON.stringify(e,null,2),c=btoa(unescape(encodeURIComponent(r))),i=await fetch(o,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({message:`deploy: Update landing configs (${Object.keys(e).length} pages)`,content:c,sha:a||void 0,branch:n})});if(!i.ok){const e=await i.json();throw new Error(e.message)}return{success:!0,message:"설정이 저장되고 배포가 시작되었습니다. (약 1~2분 소요)"}}catch(r){return{success:!1,message:r.message}}},h=async e=>{const t=c();if(!t)return{success:!1,message:"GitHub Token이 설정되지 않았습니다."};const o=`https://api.github.com/repos/${s}/${a}/contents/data/landingConfigs.json`;try{const s=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Failed to fetch existing configs");const a=await s.json(),r=a.sha,c=decodeURIComponent(escape(window.atob(a.content.replace(/\n/g,"")))),i=JSON.parse(c);if(!i[e])return{success:!0,message:"Already deleted or not found."};delete i[e];const u=JSON.stringify(i,null,2),h=btoa(unescape(encodeURIComponent(u))),p=await fetch(o,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove landing config ${e}`,content:h,sha:r,branch:n})});if(!p.ok){const e=await p.json();throw new Error(e.message)}return{success:!0,message:"GitHub에서도 삭제되었습니다."}}catch(r){return{success:!1,message:r.message}}},p=e=>new Promise((t,s)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)}),g=async()=>{const e=c();if(!e)return[];const t=`https://api.github.com/repos/${s}/${a}/contents/public/uploads`;try{const s=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok){if(404===s.status)return[];throw new Error("Failed to fetch images")}const a=await s.json();return Array.isArray(a)?a.filter(e=>"file"===e.type&&e.name.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)).map(e=>({name:e.name,path:e.path,sha:e.sha,size:e.size,url:e.html_url,download_url:e.download_url,type:e.type})):[]}catch(n){return[]}},d=async(e,t)=>{const o=c();if(!o)return!1;const r=`https://api.github.com/repos/${s}/${a}/contents/${e}`;try{return(await fetch(r,{method:"DELETE",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({message:`delete: Remove image ${e}`,sha:t,branch:n})})).ok}catch(i){return!1}},l=async()=>{const e=c();if(!e)return{success:!1,message:"GitHub Token이 설정되지 않았습니다. 설정 메뉴에서 토큰을 입력해주세요."};const t=`https://api.github.com/repos/${s}/${a}/actions/workflows/deploy.yml/dispatches`;try{const s=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${e}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({ref:n})});if(204===s.status)return{success:!0,message:"✅ 배포가 시작되었습니다! GitHub Actions에서 진행 상황을 확인하세요. (약 1분 소요)"};if(404===s.status)return{success:!1,message:"워크플로우를 찾을 수 없습니다. deploy.yml 파일이 있는지 확인하세요."};if(403===s.status)return{success:!1,message:"권한이 없습니다. GitHub Token에 workflow 권한이 있는지 확인하세요."};const a=await s.json();throw new Error(a.message||`HTTP ${s.status}`)}catch(o){return{success:!1,message:o.message}}};export{t as G,d as a,u as b,h as d,g as f,c as g,r as s,l as t,i as u};
