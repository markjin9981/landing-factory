import{j as e}from"./animation-Dic0VY_j.js";import{r as t,L as s}from"./vendor-B42Fopx7.js";import{n as a,f as r}from"./googleSheetService-cfWdSa8H.js";import{A as l}from"./arrow-left-DRtibyGX.js";import{R as n}from"./refresh-cw-CDcaT94g.js";import{F as i}from"./filter-HLpy3aI1.js";import{C as d}from"./calendar-CXo4SSaH.js";import{X as c}from"./x-Bk2wiqtD.js";import{S as x}from"./smartphone-CdZfPprM.js";import{M as m}from"./monitor-BjioZH80.js";import"./index-nvTOtYcA.js";import"./supabase-BnJ3Hf6T.js";const o=()=>{const[o,h]=t.useState([]),[g,p]=t.useState([]),[u,j]=t.useState(!0),[b,f]=t.useState("all"),[y,N]=t.useState("desc"),[w,v]=t.useState("timestamp"),[S,D]=t.useState(null),[I,C]=t.useState(!1),[k,L]=t.useState(new Date),M=async()=>{j(!0);const[e,t]=await Promise.all([a(),r()]);h(e),p(t),j(!1)};t.useEffect(()=>{M()},[]);const $=e=>{if(!e||"string"!=typeof e)return 0;const t=new Date(e).getTime();if(!isNaN(t))return t;try{const t=e.includes("오후")||e.toLowerCase().includes("pm"),s=e.includes("오전")||e.toLowerCase().includes("am"),a=e.match(/\d+/g);if(!a||a.length<3)return 0;let r=parseInt(a[0],10),l=parseInt(a[1],10)-1,n=parseInt(a[2],10),i=0,d=0,c=0;return a.length>=4&&(i=parseInt(a[3],10)),a.length>=5&&(d=parseInt(a[4],10)),a.length>=6&&(c=parseInt(a[5],10)),t&&i<12&&(i+=12),s&&12===i&&(i=0),new Date(r,l,n,i,d,c).getTime()}catch(s){return 0}},R=e=>{const t=g.find(t=>String(t.id)===String(e));return t?t.title:`(ID: ${e})`},T=t.useMemo(()=>{const e=Array.from(new Set(o.map(e=>e["Landing ID"]))).map(e=>({id:String(e),title:R(String(e))}));return e.sort((e,t)=>e.title.localeCompare(t.title)),e},[o,g]),F=t.useMemo(()=>{let e=[...o];return"all"!==b&&(e=e.filter(e=>String(e["Landing ID"])===b)),S&&(e=e.filter(e=>{const t=e.Timestamp,s=$(t);if(!s)return!1;const a=new Date(s);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`===S})),e.sort((e,t)=>{if("timestamp"===w){const s=$(e.Timestamp),a=$(t.Timestamp);return"desc"===y?a-s:s-a}if("title"===w){const s=R(String(e["Landing ID"]))||"",a=R(String(t["Landing ID"]))||"";return"asc"===y?s.localeCompare(a):a.localeCompare(s)}return 0}),e},[o,g,b,S,y,w]);return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 md:px-8 py-4 md:py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(s,{to:"/admin",className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(l,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-base md:text-xl font-bold",children:"유입 경로 상세"})]}),e.jsxs("button",{onClick:M,className:"flex items-center px-3 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-xs md:text-sm font-bold",children:[e.jsx(n,{className:"w-4 h-4 mr-1 md:mr-2 "+(u?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:"새로고침"})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-4 md:p-8",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 md:p-4 mb-4 md:mb-6 shadow-sm relative",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap md:items-center gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:"필터:"})]}),e.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"w-full md:w-auto border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"전체 랜딩페이지"}),T.map(t=>e.jsxs("option",{value:t.id,children:[t.title," (",t.id,")"]},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(!I),className:"w-full md:w-auto flex items-center justify-center gap-2 px-3 py-2 border rounded-lg text-sm "+(S?"bg-blue-50 border-blue-200 text-blue-700 font-bold":"border-gray-300 text-gray-700"),children:[e.jsx(d,{className:"w-4 h-4"}),S||"날짜 선택",S&&e.jsx(c,{className:"w-3 h-3 hover:text-red-500",onClick:e=>{e.stopPropagation(),D(null)}})]}),I&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-xl p-4 z-50 w-64 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>L(new Date(k.getFullYear(),k.getMonth()-1,1)),className:"p-1 hover:bg-gray-100 rounded",children:"<"}),e.jsxs("span",{className:"text-sm font-bold",children:[k.getFullYear(),"년 ",k.getMonth()+1,"월"]}),e.jsx("button",{onClick:()=>L(new Date(k.getFullYear(),k.getMonth()+1,1)),className:"p-1 hover:bg-gray-100 rounded",children:">"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-1",children:["일","월","화","수","목","금","토"].map(t=>e.jsx("div",{className:"text-xs text-gray-400 font-bold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:(()=>{const t=k.getFullYear(),s=k.getMonth(),a=((e,t)=>new Date(e,t+1,0).getDate())(t,s),r=((e,t)=>new Date(e,t,1).getDay())(t,s),l=[];for(let n=0;n<r;n++)l.push(e.jsx("div",{className:"h-8 w-8"},`empty-${n}`));for(let n=1;n<=a;n++){const a=`${t}-${String(s+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`,r=S===a;l.push(e.jsx("button",{onClick:()=>{D(r?null:a),C(!1)},className:`h-8 w-8 rounded-full text-xs font-bold flex items-center justify-center relative\n                    ${r?"bg-blue-600 text-white":"hover:bg-gray-100 text-gray-700"}\n                `,children:n},n))}return l})()})]})]}),e.jsx("div",{className:"hidden md:block w-px h-6 bg-gray-300 mx-2"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:"정렬:"}),e.jsxs("select",{value:w,onChange:e=>v(e.target.value),className:"border border-gray-300 rounded-lg px-2 py-1 text-xs md:text-sm outline-none",children:[e.jsx("option",{value:"timestamp",children:"시간순"}),e.jsx("option",{value:"title",children:"페이지 제목순"})]}),e.jsx("button",{onClick:()=>N(e=>"desc"===e?"asc":"desc"),className:"px-2 md:px-3 py-1 rounded text-xs md:text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold",children:"desc"===y?"▼":"▲"})]}),e.jsxs("div",{className:"md:ml-auto text-xs md:text-sm text-gray-500 text-right",children:["총 ",e.jsx("strong",{children:F.length}),"건"]})]})}),e.jsxs("div",{className:"md:hidden space-y-3",children:[F.map((t,s)=>{const a=R(String(t["Landing ID"]));return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.Timestamp}),e.jsxs("span",{className:"bg-gray-100 px-2 py-0.5 rounded text-xs font-bold text-gray-600",children:["ID: ",t["Landing ID"]]})]}),e.jsx("h3",{className:"font-bold text-blue-600 text-sm mb-2",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:["Mobile"===t.Device?e.jsx(x,{className:"w-3 h-3 text-orange-500"}):e.jsx(m,{className:"w-3 h-3 text-blue-500"}),t.Device]}),e.jsxs("div",{className:"text-gray-500",children:[t.OS," / ",t.Browser]}),e.jsx("div",{className:"font-mono text-[10px] text-gray-400",children:t.IP}),e.jsx("div",{className:"truncate max-w-[150px]",title:t.Referrer,children:"Direct"===t.Referrer?"직접 접속":t.Referrer})]})]},s)}),!u&&0===F.length&&e.jsx("div",{className:"text-center text-gray-400 py-10",children:o.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})]}),e.jsx("div",{className:"hidden md:block bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"날짜"}),e.jsx("th",{className:"px-6 py-3",children:"페이지 (Title)"}),e.jsx("th",{className:"px-6 py-3",children:"기기"}),e.jsx("th",{className:"px-6 py-3",children:"OS/브라우저"}),e.jsx("th",{className:"px-6 py-3",children:"IP"}),e.jsx("th",{className:"px-6 py-3",children:"유입경로"}),e.jsx("th",{className:"px-6 py-3",children:"랜딩ID"})]})}),e.jsxs("tbody",{children:[F.map((t,s)=>{const a=R(String(t["Landing ID"]));return e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.Timestamp}),e.jsx("td",{className:"px-6 py-4 font-bold text-blue-600",children:a}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Mobile"===t.Device?e.jsx(x,{className:"w-4 h-4 text-orange-500"}):e.jsx(m,{className:"w-4 h-4 text-blue-500"}),t.Device]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:"mr-2 text-gray-800 font-medium",children:t.OS}),e.jsx("span",{className:"text-gray-400",children:t.Browser})]}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:t.IP}),e.jsx("td",{className:"px-6 py-4 max-w-xs truncate",title:t.Referrer,children:"Direct"===t.Referrer?e.jsx("span",{className:"text-gray-400",children:"직접 접속/없음"}):e.jsx("a",{href:t.Referrer,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:t.Referrer})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-bold",children:t["Landing ID"]})})]},s)}),!u&&0===F.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-gray-400",children:o.length>0?"검색 조건에 맞는 데이터가 없습니다.":"수집된 데이터가 없습니다."})})]})]})})})]})]})};export{o as default};
