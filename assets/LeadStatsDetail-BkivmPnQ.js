import{c as D,u as J,d as Q,r as o,j as e,a as q,R as X,l as Z,f as ee,n as te}from"./index-DmniqEW1.js";import{A as se}from"./arrow-left-B1ZY7i6H.js";import{R as ae}from"./refresh-cw-DfBqbPg7.js";import{T as F}from"./trash-2-CJZxor09.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=D("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=D("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=D("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=D("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),L=i=>{if(!i||typeof i!="string")return 0;const w=new Date(i).getTime();if(!isNaN(w))return w;try{const l=i.match(/\d+/g);if(!l||l.length<3)return 0;let T=parseInt(l[0],10),d=parseInt(l[1],10)-1,I=parseInt(l[2],10),g=0,f=0;return l.length>=4&&(g=parseInt(l[3],10)),l.length>=5&&(f=parseInt(l[4],10)),(i.includes("오후")||i.toLowerCase().includes("pm"))&&g<12&&(g+=12),new Date(T,d,I,g,f).getTime()}catch{return 0}},de=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],pe=()=>{const{id:i}=J(),w=Q(),[l,T]=o.useState([]),[d,I]=o.useState(null),[g,f]=o.useState(!0),[j,K]=o.useState(""),[_,O]=o.useState("desc"),[N,H]=o.useState(""),[v,U]=o.useState(""),[h,S]=o.useState(1),C=10,[c,p]=o.useState(new Set),[x,B]=o.useState(!1),[ie,ce]=o.useState(!1),[y,k]=o.useState(0),[z,R]=o.useState(!1),E=async()=>{f(!0),p(new Set);try{const[t,s]=await Promise.all([Z(),ee()]),a=s.find(n=>String(n.id)===String(i));I(a||null);const r=t.filter(n=>String(n["Landing ID"])===String(i));T(r)}catch(t){console.error(t)}finally{f(!1)}};o.useEffect(()=>{E()},[i]);const M=o.useMemo(()=>{let t=[...l];if(j){const s=j.toLowerCase();t=t.filter(a=>{const r=String(a.Name||"").toLowerCase(),n=String(a.Phone||"").toLowerCase();return r.includes(s)||n.includes(s)})}if(N){const s=new Date(N).setHours(0,0,0,0);t=t.filter(a=>L(a.Timestamp)>=s)}if(v){const s=new Date(v).setHours(23,59,59,999);t=t.filter(a=>L(a.Timestamp)<=s)}return t.sort((s,a)=>{const r=L(s.Timestamp),n=L(a.Timestamp);return _==="desc"?n-r:r-n}),t},[l,j,N,v,_]),b=Math.ceil(M.length/C),u=M.slice((h-1)*C,h*C),{columns:$,extraKeys:A}=o.useMemo(()=>{var r;const t=[{key:"Timestamp",label:"시간"}],s=new Set(["Timestamp","Landing ID"]);(r=d==null?void 0:d.formConfig)!=null&&r.fields?d.formConfig.fields.forEach(n=>{t.push({key:n.id,label:n.label}),s.add(n.id),s.add(n.id.toLowerCase()),n.type==="address"&&s.add(`${n.id}_detail`)}):l.length>0&&(l[0].Name&&(t.push({key:"Name",label:"이름"}),s.add("Name")),l[0].Phone&&(t.push({key:"Phone",label:"연락처"}),s.add("Phone")));const a=new Set;return l.forEach(n=>{Object.keys(n).forEach(m=>{s.has(m)||s.has(m.toLowerCase())||de.includes(m.toLowerCase())||m.startsWith("consent_")||a.add(m)})}),a.has("Memo")&&(a.delete("Memo"),t.push({key:"Memo",label:"메모"})),{columns:t,extraKeys:Array.from(a)}},[d,l]),G=t=>{const s=new Set(c);s.has(t)?s.delete(t):s.add(t),p(s)},V=()=>{if(c.size===u.length)p(new Set);else{const t=new Set;u.forEach((s,a)=>t.add(a)),p(t)}},W=()=>{c.size!==0&&k(1)},Y=async()=>{if(y===1){k(2);return}R(!0);const s=Array.from(c).map(r=>u[r]).map(r=>({timestamp:r.Timestamp,landing_id:r["Landing ID"],name:r.Name,phone:r.Phone})),a=await te(s);a.result==="success"?(await E(),k(0),p(new Set)):alert("삭제 실패: "+a.message),R(!1)};return g?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(q,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>w("/admin/stats"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(se,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[d?d.title:`페이지 ID: ${i}`,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full",children:[l.length,"건"]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:E,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"})," 새로고침"]})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 또는 전화번호 검색",value:j,onChange:t=>{K(t.target.value),S(1)},className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"text-gray-500",children:"기간:"}),e.jsx("input",{type:"date",value:N,onChange:t=>H(t.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:v,onChange:t=>U(t.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>O(t=>t==="desc"?"asc":"desc"),className:"flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 text-gray-700 font-bold",children:[e.jsx(re,{className:"w-4 h-4"}),_==="desc"?"최신순":"오래된순"]}),e.jsxs("button",{onClick:()=>{B(!x),p(new Set)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-colors ${x?"bg-red-50 text-red-600 border border-red-200":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(F,{className:"w-4 h-4"}),x?"삭제 취소":"항목 삭제"]}),x&&c.size>0&&e.jsxs("button",{onClick:W,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 shadow-sm animate-fade-in",children:[c.size,"개 삭제하기"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[x&&e.jsx("th",{className:"px-6 py-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:V,checked:c.size>0&&c.size===u.length,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),$.map(t=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:t.label},t.key)),A.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[u.map((t,s)=>e.jsxs("tr",{className:`hover:bg-blue-50/30 transition-colors ${x&&c.has(s)?"bg-red-50/50":""}`,children:[x&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:c.has(s),onChange:()=>G(s),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"})}),e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs text-center",children:M.length-((h-1)*C+s)}),$.map(a=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:(()=>{var n;const r=(n=d==null?void 0:d.formConfig)==null?void 0:n.fields.find(m=>m.id===a.key);if((r==null?void 0:r.type)==="address"){const m=t[a.key]||t[a.key.toLowerCase()]||"",P=t[`${a.key}_detail`]||t[`${a.key.toLowerCase()}_detail`]||"";return!m&&!P?"-":e.jsxs("div",{className:"whitespace-pre-wrap break-words min-w-[200px]",children:[m,P&&e.jsx("span",{className:"block text-gray-500 text-xs mt-0.5",children:P})]})}return t[a.key]||t[a.key.toLowerCase()]||"-"})()},a.key)),A.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:A.map(a=>{const r=t[a];return r?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-300",children:[a,":"]}),e.jsx("span",{children:r})]},a):null})})]},s)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-20 text-center text-gray-400 bg-gray-50/30",children:"데이터가 없습니다."})})]})]})})}),b>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("button",{onClick:()=>S(1),disabled:h===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(ne,{className:"w-4 h-4"})}),Array.from({length:b},(t,s)=>s+1).filter(t=>t===1||t===b||Math.abs(t-h)<=2).map((t,s,a)=>{const r=a[s-1],n=r&&t-r>1;return e.jsxs(X.Fragment,{children:[n&&e.jsx("span",{className:"text-gray-300",children:"..."}),e.jsx("button",{onClick:()=>S(t),className:`w-8 h-8 rounded-lg text-sm font-bold transition-all ${h===t?"bg-gray-900 text-white shadow-md transform scale-105":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:t})]},t)}),e.jsx("button",{onClick:()=>S(b),disabled:h===b,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),y>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-100",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(F,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:y===1?"선택한 항목 삭제":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep",children:y===1?e.jsxs(e.Fragment,{children:["총 ",e.jsxs("strong",{children:[c.size,"개"]}),"의 데이터를 삭제합니다.",e.jsx("br",{}),"계속 하시겠습니까?"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{children:"절대 복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(0),className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:Y,disabled:z,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:z?e.jsx(q,{className:"w-5 h-5 animate-spin"}):y===1?"계속하기":"삭제 확정"})]})]})})]})};export{pe as default};
