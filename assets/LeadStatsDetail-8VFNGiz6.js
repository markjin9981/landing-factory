import{c as L,u as Y,d as J,r as o,j as e,a as q,R as Q,k as X,f as Z,m as ee}from"./index-CpBRf0OQ.js";import{A as te}from"./arrow-left-DiermuT6.js";import{R as se}from"./refresh-cw-BZpdq0Vk.js";import{T as F}from"./trash-2-Df0xRHNS.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=L("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=L("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=L("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),D=c=>{if(!c||typeof c!="string")return 0;const j=new Date(c).getTime();if(!isNaN(j))return j;try{const n=c.match(/\d+/g);if(!n||n.length<3)return 0;let T=parseInt(n[0],10),d=parseInt(n[1],10)-1,I=parseInt(n[2],10),x=0,u=0;return n.length>=4&&(x=parseInt(n[3],10)),n.length>=5&&(u=parseInt(n[4],10)),(c.includes("오후")||c.toLowerCase().includes("pm"))&&x<12&&(x+=12),new Date(T,d,I,x,u).getTime()}catch{return 0}},oe=["landing_id","timestamp","user_agent","referrer","page_title","marketing_consent","third_party_consent","privacy_consent","type"],ge=()=>{const{id:c}=Y(),j=J(),[n,T]=o.useState([]),[d,I]=o.useState(null),[x,u]=o.useState(!0),[w,K]=o.useState(""),[_,$]=o.useState("desc"),[N,O]=o.useState(""),[v,H]=o.useState(""),[m,S]=o.useState(1),C=10,[i,g]=o.useState(new Set),[h,U]=o.useState(!1),[ce,ie]=o.useState(!1),[f,k]=o.useState(0),[A,z]=o.useState(!1),E=async()=>{u(!0),g(new Set);try{const[t,s]=await Promise.all([X(),Z()]),a=s.find(l=>String(l.id)===String(c));I(a||null);const r=t.filter(l=>String(l["Landing ID"])===String(c));T(r)}catch(t){console.error(t)}finally{u(!1)}};o.useEffect(()=>{E()},[c]);const M=o.useMemo(()=>{let t=[...n];if(w){const s=w.toLowerCase();t=t.filter(a=>{const r=String(a.Name||"").toLowerCase(),l=String(a.Phone||"").toLowerCase();return r.includes(s)||l.includes(s)})}if(N){const s=new Date(N).setHours(0,0,0,0);t=t.filter(a=>D(a.Timestamp)>=s)}if(v){const s=new Date(v).setHours(23,59,59,999);t=t.filter(a=>D(a.Timestamp)<=s)}return t.sort((s,a)=>{const r=D(s.Timestamp),l=D(a.Timestamp);return _==="desc"?l-r:r-l}),t},[n,w,N,v,_]),y=Math.ceil(M.length/C),p=M.slice((m-1)*C,m*C),{columns:R,extraKeys:P}=o.useMemo(()=>{var r;const t=[{key:"Timestamp",label:"시간"}],s=new Set(["Timestamp","Landing ID"]);(r=d==null?void 0:d.formConfig)!=null&&r.fields?d.formConfig.fields.forEach(l=>{t.push({key:l.id,label:l.label}),s.add(l.id),s.add(l.id.toLowerCase())}):n.length>0&&(n[0].Name&&(t.push({key:"Name",label:"이름"}),s.add("Name")),n[0].Phone&&(t.push({key:"Phone",label:"연락처"}),s.add("Phone")));const a=new Set;return n.forEach(l=>{Object.keys(l).forEach(b=>{s.has(b)||s.has(b.toLowerCase())||oe.includes(b.toLowerCase())||b.startsWith("consent_")||a.add(b)})}),a.has("Memo")&&(a.delete("Memo"),t.push({key:"Memo",label:"메모"})),{columns:t,extraKeys:Array.from(a)}},[d,n]),B=t=>{const s=new Set(i);s.has(t)?s.delete(t):s.add(t),g(s)},G=()=>{if(i.size===p.length)g(new Set);else{const t=new Set;p.forEach((s,a)=>t.add(a)),g(t)}},V=()=>{i.size!==0&&k(1)},W=async()=>{if(f===1){k(2);return}z(!0);const s=Array.from(i).map(r=>p[r]).map(r=>({timestamp:r.Timestamp,landing_id:r["Landing ID"],name:r.Name,phone:r.Phone})),a=await ee(s);a.result==="success"?(await E(),k(0),g(new Set)):alert("삭제 실패: "+a.message),z(!1)};return x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(q,{className:"w-8 h-8 text-blue-600 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-8 py-5 flex items-center justify-between sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>j("/admin/stats"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(te,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[d?d.title:`페이지 ID: ${c}`,e.jsxs("span",{className:"text-sm font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full",children:[n.length,"건"]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:E,className:"flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 text-sm font-bold",children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," 새로고침"]})})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8 space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 또는 전화번호 검색",value:w,onChange:t=>{K(t.target.value),S(1)},className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-64"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"text-gray-500",children:"기간:"}),e.jsx("input",{type:"date",value:N,onChange:t=>O(t.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"date",value:v,onChange:t=>H(t.target.value),className:"bg-transparent outline-none text-gray-700 font-medium"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>$(t=>t==="desc"?"asc":"desc"),className:"flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 text-gray-700 font-bold",children:[e.jsx(ae,{className:"w-4 h-4"}),_==="desc"?"최신순":"오래된순"]}),e.jsxs("button",{onClick:()=>{U(!h),g(new Set)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-colors ${h?"bg-red-50 text-red-600 border border-red-200":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(F,{className:"w-4 h-4"}),h?"삭제 취소":"항목 삭제"]}),h&&i.size>0&&e.jsxs("button",{onClick:V,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 shadow-sm animate-fade-in",children:[i.size,"개 삭제하기"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:e.jsxs("tr",{children:[h&&e.jsx("th",{className:"px-6 py-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:G,checked:i.size>0&&i.size===p.length,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-3 w-12 font-medium",children:"No."}),R.map(t=>e.jsx("th",{className:"px-6 py-3 font-medium text-gray-700",children:t.label},t.key)),P.length>0&&e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"추가 정보"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[p.map((t,s)=>e.jsxs("tr",{className:`hover:bg-blue-50/30 transition-colors ${h&&i.has(s)?"bg-red-50/50":""}`,children:[h&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:i.has(s),onChange:()=>B(s),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"})}),e.jsx("td",{className:"px-6 py-4 text-gray-400 text-xs text-center",children:M.length-((m-1)*C+s)}),R.map(a=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:t[a.key]||t[a.key.toLowerCase()]||"-"},a.key)),P.length>0&&e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:P.map(a=>{const r=t[a];return r?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("span",{className:"font-bold text-gray-300",children:[a,":"]}),e.jsx("span",{children:r})]},a):null})})]},s)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-20 text-center text-gray-400 bg-gray-50/30",children:"데이터가 없습니다."})})]})]})})}),y>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("button",{onClick:()=>S(1),disabled:m===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(re,{className:"w-4 h-4"})}),Array.from({length:y},(t,s)=>s+1).filter(t=>t===1||t===y||Math.abs(t-m)<=2).map((t,s,a)=>{const r=a[s-1],l=r&&t-r>1;return e.jsxs(Q.Fragment,{children:[l&&e.jsx("span",{className:"text-gray-300",children:"..."}),e.jsx("button",{onClick:()=>S(t),className:`w-8 h-8 rounded-lg text-sm font-bold transition-all ${m===t?"bg-gray-900 text-white shadow-md transform scale-105":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:t})]},t)}),e.jsx("button",{onClick:()=>S(y),disabled:m===y,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-30 disabled:hover:bg-white",children:e.jsx(ne,{className:"w-4 h-4"})})]})]}),f>0&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-100",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx(F,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-2",children:f===1?"선택한 항목 삭제":"정말 삭제하시겠습니까?"}),e.jsx("p",{className:"text-center text-gray-500 mb-8 break-keep",children:f===1?e.jsxs(e.Fragment,{children:["총 ",e.jsxs("strong",{children:[i.size,"개"]}),"의 데이터를 삭제합니다.",e.jsx("br",{}),"계속 하시겠습니까?"]}):e.jsxs(e.Fragment,{children:["삭제된 데이터는 ",e.jsx("strong",{children:"절대 복구할 수 없습니다."}),e.jsx("br",{}),"신중하게 결정해 주세요."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(0),className:"flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{onClick:W,disabled:A,className:"flex-1 py-3 px-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200 disabled:opacity-70 disabled:cursor-wait flex justify-center items-center",children:A?e.jsx(q,{className:"w-5 h-5 animate-spin"}):f===1?"계속하기":"삭제 확정"})]})]})})]})};export{ge as default};
